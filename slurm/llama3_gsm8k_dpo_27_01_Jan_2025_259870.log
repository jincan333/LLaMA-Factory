0: num_nodes: 1
0: SLURM_NODEID: 0
0: CUDA_VISIBLE_DEVICES: 0,1,2,3
0: output_dir: /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048
0: [2025-01-01 21:27:48,143] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
0: Warning: The cache directory for DeepSpeed Triton autotune, /u/cjin1/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
0: [INFO|2025-01-01 21:27:54] llamafactory.cli:157 >> Initializing distributed tasks at: gh119:29501
0: [2025-01-01 21:28:02,907] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
0: [2025-01-01 21:28:02,907] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
0: Warning: The cache directory for DeepSpeed Triton autotune, /u/cjin1/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.Warning: The cache directory for DeepSpeed Triton autotune, /u/cjin1/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
0: 
0: [2025-01-01 21:28:03,609] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
0: Warning: The cache directory for DeepSpeed Triton autotune, /u/cjin1/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
0: [2025-01-01 21:28:04,074] [INFO] [real_accelerator.py:219:get_accelerator] Setting ds_accelerator to cuda (auto detect)
0: Warning: The cache directory for DeepSpeed Triton autotune, /u/cjin1/.triton/autotune, appears to be on an NFS system. While this is generally acceptable, if you experience slowdowns or hanging when DeepSpeed exits, it is recommended to set the TRITON_CACHE_DIR environment variable to a non-NFS path.
0: [2025-01-01 21:28:04,906] [INFO] [comm.py:652:init_distributed] cdb=None
0: [2025-01-01 21:28:04,906] [INFO] [comm.py:652:init_distributed] cdb=None
0: [2025-01-01 21:28:05,358] [INFO] [comm.py:652:init_distributed] cdb=None
0: [2025-01-01 21:28:05,358] [INFO] [comm.py:683:init_distributed] Initializing TorchBackend in DeepSpeed with backend nccl
0: [2025-01-01 21:28:05,889] [INFO] [comm.py:652:init_distributed] cdb=None
0: [INFO|2025-01-01 21:28:06] llamafactory.hparams.parser:359 >> Process rank: 0, device: cuda:0, n_gpu: 1, distributed training: True, compute dtype: torch.bfloat16
0: [INFO|2025-01-01 21:28:06] llamafactory.hparams.parser:359 >> Process rank: 3, device: cuda:3, n_gpu: 1, distributed training: True, compute dtype: torch.bfloat16
0: [INFO|2025-01-01 21:28:06] llamafactory.hparams.parser:359 >> Process rank: 2, device: cuda:2, n_gpu: 1, distributed training: True, compute dtype: torch.bfloat16
0: [INFO|2025-01-01 21:28:06] llamafactory.hparams.parser:359 >> Process rank: 1, device: cuda:1, n_gpu: 1, distributed training: True, compute dtype: torch.bfloat16
0: [INFO|configuration_utils.py:679] 2025-01-01 21:28:49,171 >> loading configuration file config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/config.json
0: [INFO|configuration_utils.py:746] 2025-01-01 21:28:49,172 >> Model config LlamaConfig {
0:   "_name_or_path": "meta-llama/Meta-Llama-3-8B-Instruct",
0:   "architectures": [
0:     "LlamaForCausalLM"
0:   ],
0:   "attention_bias": false,
0:   "attention_dropout": 0.0,
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009,
0:   "head_dim": 128,
0:   "hidden_act": "silu",
0:   "hidden_size": 4096,
0:   "initializer_range": 0.02,
0:   "intermediate_size": 14336,
0:   "max_position_embeddings": 8192,
0:   "mlp_bias": false,
0:   "model_type": "llama",
0:   "num_attention_heads": 32,
0:   "num_hidden_layers": 32,
0:   "num_key_value_heads": 8,
0:   "pretraining_tp": 1,
0:   "rms_norm_eps": 1e-05,
0:   "rope_scaling": null,
0:   "rope_theta": 500000.0,
0:   "tie_word_embeddings": false,
0:   "torch_dtype": "bfloat16",
0:   "transformers_version": "4.46.1",
0:   "use_cache": true,
0:   "vocab_size": 128256
0: }
0: 
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,101 >> loading file tokenizer.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,101 >> loading file tokenizer.model from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,101 >> loading file added_tokens.json from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,101 >> loading file special_tokens_map.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/special_tokens_map.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,101 >> loading file tokenizer_config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer_config.json
0: [INFO|tokenization_utils_base.py:2475] 2025-01-01 21:28:54,358 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
0: [INFO|configuration_utils.py:679] 2025-01-01 21:28:54,882 >> loading configuration file config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/config.json
0: [INFO|configuration_utils.py:746] 2025-01-01 21:28:54,882 >> Model config LlamaConfig {
0:   "_name_or_path": "meta-llama/Meta-Llama-3-8B-Instruct",
0:   "architectures": [
0:     "LlamaForCausalLM"
0:   ],
0:   "attention_bias": false,
0:   "attention_dropout": 0.0,
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009,
0:   "head_dim": 128,
0:   "hidden_act": "silu",
0:   "hidden_size": 4096,
0:   "initializer_range": 0.02,
0:   "intermediate_size": 14336,
0:   "max_position_embeddings": 8192,
0:   "mlp_bias": false,
0:   "model_type": "llama",
0:   "num_attention_heads": 32,
0:   "num_hidden_layers": 32,
0:   "num_key_value_heads": 8,
0:   "pretraining_tp": 1,
0:   "rms_norm_eps": 1e-05,
0:   "rope_scaling": null,
0:   "rope_theta": 500000.0,
0:   "tie_word_embeddings": false,
0:   "torch_dtype": "bfloat16",
0:   "transformers_version": "4.46.1",
0:   "use_cache": true,
0:   "vocab_size": 128256
0: }
0: 
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,934 >> loading file tokenizer.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,934 >> loading file tokenizer.model from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,934 >> loading file added_tokens.json from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,934 >> loading file special_tokens_map.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/special_tokens_map.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:28:54,934 >> loading file tokenizer_config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer_config.json
0: [INFO|tokenization_utils_base.py:2475] 2025-01-01 21:28:55,161 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
0: [INFO|2025-01-01 21:28:55] llamafactory.data.template:157 >> Add pad token: <|eot_id|>
0: [INFO|2025-01-01 21:28:55] llamafactory.data.template:157 >> Add <|eot_id|>,<|eom_id|> to stop words.
0: [WARNING|2025-01-01 21:28:55] llamafactory.data.template:162 >> New tokens have been added, make sure `resize_vocab` is True.
0: [INFO|2025-01-01 21:28:55] llamafactory.data.loader:157 >> Loading dataset gsm8k/dpo.json...
0: Converting format of dataset:   0%|          | 0/7473 [00:00<?, ? examples/s]Converting format of dataset:  25%|â–ˆâ–ˆâ–       | 1833/7473 [00:00<00:00, 18220.85 examples/s]Converting format of dataset:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 3666/7473 [00:00<00:00, 18280.59 examples/s]Converting format of dataset:  86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 6397/7473 [00:00<00:00, 18234.91 examples/s]Converting format of dataset: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7473/7473 [00:00<00:00, 18263.81 examples/s]
0: [INFO|2025-01-01 21:29:01] llamafactory.data.loader:157 >> Loading dataset gsm8k/dpo.json...
0: Running tokenizer on dataset:   0%|          | 0/7473 [00:00<?, ? examples/s]Running tokenizer on dataset:  13%|â–ˆâ–Ž        | 1000/7473 [00:00<00:05, 1097.52 examples/s]Running tokenizer on dataset:  27%|â–ˆâ–ˆâ–‹       | 2000/7473 [00:01<00:04, 1174.03 examples/s]Running tokenizer on dataset:  40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 3000/7473 [00:02<00:03, 1202.02 examples/s]Running tokenizer on dataset:  54%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 4000/7473 [00:03<00:02, 1216.67 examples/s]Running tokenizer on dataset:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 5000/7473 [00:04<00:02, 1214.31 examples/s]Running tokenizer on dataset:  80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 6000/7473 [00:04<00:01, 1212.29 examples/s]Running tokenizer on dataset:  94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 7000/7473 [00:05<00:00, 1203.71 examples/s]Running tokenizer on dataset: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7473/7473 [00:06<00:00, 1201.75 examples/s]Running tokenizer on dataset: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 7473/7473 [00:06<00:00, 1197.87 examples/s]
0: training example:
0: chosen_input_ids:
0: [128000, 128006, 882, 128007, 271, 791, 3430, 315, 459, 12443, 11299, 220, 605, 4, 304, 264, 4040, 2305, 323, 2500, 220, 508, 4, 304, 279, 2132, 2305, 13, 220, 1442, 279, 2926, 3430, 574, 400, 1041, 15, 11, 11294, 279, 3430, 1306, 279, 2132, 2305, 13, 128009, 128006, 78191, 128007, 271, 644, 279, 1176, 2305, 11, 279, 3430, 315, 279, 12443, 11299, 555, 220, 605, 14, 1041, 40118, 1041, 15, 3266, 2501, 605, 14, 1041, 9, 1041, 15, 28, 1041, 2511, 1041, 198, 791, 502, 3430, 1306, 279, 1176, 2305, 374, 400, 1041, 15, 22104, 1041, 284, 400, 2501, 1041, 15, 12, 1041, 28, 7467, 2511, 7467, 198, 644, 279, 2132, 2305, 11, 279, 3430, 11299, 220, 508, 4, 4726, 555, 220, 508, 14, 1041, 40118, 7467, 284, 400, 2501, 508, 14, 1041, 9, 7467, 28, 5245, 2511, 5245, 198, 791, 502, 3430, 1306, 279, 2132, 2305, 374, 400, 7467, 22104, 5245, 284, 400, 2501, 7467, 12, 5245, 28, 13104, 2511, 13104, 198, 827, 220, 13104, 128009]
0: chosen_inputs:
0: <|begin_of_text|><|start_header_id|>user<|end_header_id|>
0: 
0: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.<|eot_id|><|start_header_id|>assistant<|end_header_id|>
0: 
0: In the first month, the price of the iPhone fell by 10/100*$1000=$<<10/100*1000=100>>100
0: The new price after the first month is $1000-$100 = $<<1000-100=900>>900
0: In the second month, the price fell 20% further by 20/100*$900 = $<<20/100*900=180>>180
0: The new price after the second month is $900-$180 = $<<900-180=720>>720
0: #### 720<|eot_id|>
0: chosen_label_ids:
0: [-100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, 644, 279, 1176, 2305, 11, 279, 3430, 315, 279, 12443, 11299, 555, 220, 605, 14, 1041, 40118, 1041, 15, 3266, 2501, 605, 14, 1041, 9, 1041, 15, 28, 1041, 2511, 1041, 198, 791, 502, 3430, 1306, 279, 1176, 2305, 374, 400, 1041, 15, 22104, 1041, 284, 400, 2501, 1041, 15, 12, 1041, 28, 7467, 2511, 7467, 198, 644, 279, 2132, 2305, 11, 279, 3430, 11299, 220, 508, 4, 4726, 555, 220, 508, 14, 1041, 40118, 7467, 284, 400, 2501, 508, 14, 1041, 9, 7467, 28, 5245, 2511, 5245, 198, 791, 502, 3430, 1306, 279, 2132, 2305, 374, 400, 7467, 22104, 5245, 284, 400, 2501, 7467, 12, 5245, 28, 13104, 2511, 13104, 198, 827, 220, 13104, 128009]
0: chosen_labels:
0: In the first month, the price of the iPhone fell by 10/100*$1000=$<<10/100*1000=100>>100
0: The new price after the first month is $1000-$100 = $<<1000-100=900>>900
0: In the second month, the price fell 20% further by 20/100*$900 = $<<20/100*900=180>>180
0: The new price after the second month is $900-$180 = $<<900-180=720>>720
0: #### 720<|eot_id|>
0: rejected_input_ids:
0: [128000, 128006, 882, 128007, 271, 791, 3430, 315, 459, 12443, 11299, 220, 605, 4, 304, 264, 4040, 2305, 323, 2500, 220, 508, 4, 304, 279, 2132, 2305, 13, 220, 1442, 279, 2926, 3430, 574, 400, 1041, 15, 11, 11294, 279, 3430, 1306, 279, 2132, 2305, 13, 128009, 128006, 78191, 128007, 271, 40, 4265, 387, 6380, 311, 1520, 499, 449, 430, 13, 5810, 596, 279, 6425, 1473, 91084, 11, 279, 3430, 315, 279, 12443, 374, 400, 1041, 15, 382, 644, 279, 1176, 2305, 11, 279, 3430, 17503, 555, 220, 605, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 1041, 15, 482, 320, 605, 4, 315, 400, 1041, 15, 8, 284, 400, 1041, 15, 482, 400, 1041, 284, 400, 7467, 271, 644, 279, 2132, 2305, 11, 279, 3430, 17503, 555, 2500, 220, 508, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 7467, 482, 320, 508, 4, 315, 400, 7467, 8, 284, 400, 7467, 482, 400, 5245, 284, 400, 13104, 271, 10267, 596, 10356, 1057, 22702, 555, 9455, 279, 2860, 11668, 18979, 512, 6475, 3430, 284, 400, 1041, 15, 198, 7117, 1306, 1176, 2305, 284, 400, 7467, 198, 7117, 1306, 213
0: 2, 2305, 284, 400, 13104, 271, 791, 2860, 11668, 18979, 284, 320, 6475, 3430, 482, 8650, 1306, 2132, 2305, 8, 611, 4220, 3430, 198, 28, 1746, 1041, 15, 482, 400, 13104, 8, 611, 400, 1041, 15, 198, 28, 400, 11209, 611, 400, 1041, 15, 198, 28, 220, 1591, 15804, 2028, 9248, 279, 3685, 2860, 11668, 18979, 315, 220, 966, 4, 320, 605, 4, 304, 279, 1176, 2305, 489, 220, 508, 4, 304, 279, 2132, 2305, 3677, 578, 4320, 374, 400, 13104, 13, 128009]
0: rejected_inputs:
0: <|begin_of_text|><|start_header_id|>user<|end_header_id|>
0: 
0: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.<|eot_id|><|start_header_id|>assistant<|end_header_id|>
0: 
0: I'd be happy to help you with that. Here's the solution:
0: 
0: Initially, the price of the iPhone is $1000.
0: 
0: In the first month, the price falls by 10%, which means the new price is:
0: $1000 - (10% of $1000) = $1000 - $100 = $900
0: 
0: In the second month, the price falls by another 20%, which means the new price is:
0: $900 - (20% of $900) = $900 - $180 = $720
0: 
0: Let's verify our calculation by finding the total percentage decrease:
0: Initial price = $1000
0: Price after first month = $900
0: Price after second month = $720
0: 
0: The total percentage decrease = (Initial price - Price after second month) / Initial price
0: = ($1000 - $720) / $1000
0: = $280 / $1000
0: = 28%
0: 
0: This matches the expected total percentage decrease of 30% (10% in the first month + 20% in the second month).
0: 
0:  The answer is $720.<|eot_id|>
0: rejected_label_ids:
0: [-100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, 40, 4265, 387, 6380, 311, 1520, 499, 449, 430, 13, 5810, 596, 279, 6425, 1473, 91084, 11, 279, 3430, 315, 279, 12443, 374, 400, 1041, 15, 382, 644, 279, 1176, 2305, 11, 279, 3430, 17503, 555, 220, 605, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 1041, 15, 482, 320, 605, 4, 315, 400, 1041, 15, 8, 284, 400, 1041, 15, 482, 400, 1041, 284, 400, 7467, 271, 644, 279, 2132, 2305, 11, 279, 3430, 17503, 555, 2500, 220, 508, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 7467, 482, 320, 508, 4, 315, 400, 7467, 8, 284, 400, 7467, 482, 400, 5245, 284, 400, 13104, 271, 10267, 596, 10356, 1057, 22702, 555, 9455, 279, 2860, 11668, 18979, 512, 6475, 3430, 284, 400, 1041, 15, 198, 7117, 1306, 1176, 2305, 284, 400, 7467, 1
0: 98, 7117, 1306, 2132, 2305, 284, 400, 13104, 271, 791, 2860, 11668, 18979, 284, 320, 6475, 3430, 482, 8650, 1306, 2132, 2305, 8, 611, 4220, 3430, 198, 28, 1746, 1041, 15, 482, 400, 13104, 8, 611, 400, 1041, 15, 198, 28, 400, 11209, 611, 400, 1041, 15, 198, 28, 220, 1591, 15804, 2028, 9248, 279, 3685, 2860, 11668, 18979, 315, 220, 966, 4, 320, 605, 4, 304, 279, 1176, 2305, 489, 220, 508, 4, 304, 279, 2132, 2305, 3677, 578, 4320, 374, 400, 13104, 13, 128009]
0: rejected_labels:
0: I'd be happy to help you with that. Here's the solution:
0: 
0: Initially, the price of the iPhone is $1000.
0: 
0: In the first month, the price falls by 10%, which means the new price is:
0: $1000 - (10% of $1000) = $1000 - $100 = $900
0: 
0: In the second month, the price falls by another 20%, which means the new price is:
0: $900 - (20% of $900) = $900 - $180 = $720
0: 
0: Let's verify our calculation by finding the total percentage decrease:
0: Initial price = $1000
0: Price after first month = $900
0: Price after second month = $720
0: 
0: The total percentage decrease = (Initial price - Price after second month) / Initial price
0: = ($1000 - $720) / $1000
0: = $280 / $1000
0: = 28%
0: 
0: This matches the expected total percentage decrease of 30% (10% in the first month + 20% in the second month).
0: 
0:  The answer is $720.<|eot_id|>
0: eval example:
0: chosen_input_ids:
0: [128000, 128006, 882, 128007, 271, 791, 3430, 315, 459, 12443, 11299, 220, 605, 4, 304, 264, 4040, 2305, 323, 2500, 220, 508, 4, 304, 279, 2132, 2305, 13, 220, 1442, 279, 2926, 3430, 574, 400, 1041, 15, 11, 11294, 279, 3430, 1306, 279, 2132, 2305, 13, 128009, 128006, 78191, 128007, 271, 644, 279, 1176, 2305, 11, 279, 3430, 315, 279, 12443, 11299, 555, 220, 605, 14, 1041, 40118, 1041, 15, 3266, 2501, 605, 14, 1041, 9, 1041, 15, 28, 1041, 2511, 1041, 198, 791, 502, 3430, 1306, 279, 1176, 2305, 374, 400, 1041, 15, 22104, 1041, 284, 400, 2501, 1041, 15, 12, 1041, 28, 7467, 2511, 7467, 198, 644, 279, 2132, 2305, 11, 279, 3430, 11299, 220, 508, 4, 4726, 555, 220, 508, 14, 1041, 40118, 7467, 284, 400, 2501, 508, 14, 1041, 9, 7467, 28, 5245, 2511, 5245, 198, 791, 502, 3430, 1306, 279, 2132, 2305, 374, 400, 7467, 22104, 5245, 284, 400, 2501, 7467, 12, 5245, 28, 13104, 2511, 13104, 198, 827, 220, 13104, 128009]
0: chosen_inputs:
0: <|begin_of_text|><|start_header_id|>user<|end_header_id|>
0: 
0: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.<|eot_id|><|start_header_id|>assistant<|end_header_id|>
0: 
0: In the first month, the price of the iPhone fell by 10/100*$1000=$<<10/100*1000=100>>100
0: The new price after the first month is $1000-$100 = $<<1000-100=900>>900
0: In the second month, the price fell 20% further by 20/100*$900 = $<<20/100*900=180>>180
0: The new price after the second month is $900-$180 = $<<900-180=720>>720
0: #### 720<|eot_id|>
0: chosen_label_ids:
0: [-100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, 644, 279, 1176, 2305, 11, 279, 3430, 315, 279, 12443, 11299, 555, 220, 605, 14, 1041, 40118, 1041, 15, 3266, 2501, 605, 14, 1041, 9, 1041, 15, 28, 1041, 2511, 1041, 198, 791, 502, 3430, 1306, 279, 1176, 2305, 374, 400, 1041, 15, 22104, 1041, 284, 400, 2501, 1041, 15, 12, 1041, 28, 7467, 2511, 7467, 198, 644, 279, 2132, 2305, 11, 279, 3430, 11299, 220, 508, 4, 4726, 555, 220, 508, 14, 1041, 40118, 7467, 284, 400, 2501, 508, 14, 1041, 9, 7467, 28, 5245, 2511, 5245, 198, 791, 502, 3430, 1306, 279, 2132, 2305, 374, 400, 7467, 22104, 5245, 284, 400, 2501, 7467, 12, 5245, 28, 13104, 2511, 13104, 198, 827, 220, 13104, 128009]
0: chosen_labels:
0: In the first month, the price of the iPhone fell by 10/100*$1000=$<<10/100*1000=100>>100
0: The new price after the first month is $1000-$100 = $<<1000-100=900>>900
0: In the second month, the price fell 20% further by 20/100*$900 = $<<20/100*900=180>>180
0: The new price after the second month is $900-$180 = $<<900-180=720>>720
0: #### 720<|eot_id|>
0: rejected_input_ids:
0: [128000, 128006, 882, 128007, 271, 791, 3430, 315, 459, 12443, 11299, 220, 605, 4, 304, 264, 4040, 2305, 323, 2500, 220, 508, 4, 304, 279, 2132, 2305, 13, 220, 1442, 279, 2926, 3430, 574, 400, 1041, 15, 11, 11294, 279, 3430, 1306, 279, 2132, 2305, 13, 128009, 128006, 78191, 128007, 271, 40, 4265, 387, 6380, 311, 1520, 499, 449, 430, 13, 5810, 596, 279, 6425, 1473, 91084, 11, 279, 3430, 315, 279, 12443, 374, 400, 1041, 15, 382, 644, 279, 1176, 2305, 11, 279, 3430, 17503, 555, 220, 605, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 1041, 15, 482, 320, 605, 4, 315, 400, 1041, 15, 8, 284, 400, 1041, 15, 482, 400, 1041, 284, 400, 7467, 271, 644, 279, 2132, 2305, 11, 279, 3430, 17503, 555, 2500, 220, 508, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 7467, 482, 320, 508, 4, 315, 400, 7467, 8, 284, 400, 7467, 482, 400, 5245, 284, 400, 13104, 271, 10267, 596, 10356, 1057, 22702, 555, 9455, 279, 2860, 11668, 18979, 512, 6475, 3430, 284, 400, 1041, 15, 198, 7117, 1306, 1176, 2305, 284, 400, 7467, 198, 7117, 1306, 213
0: 2, 2305, 284, 400, 13104, 271, 791, 2860, 11668, 18979, 284, 320, 6475, 3430, 482, 8650, 1306, 2132, 2305, 8, 611, 4220, 3430, 198, 28, 1746, 1041, 15, 482, 400, 13104, 8, 611, 400, 1041, 15, 198, 28, 400, 11209, 611, 400, 1041, 15, 198, 28, 220, 1591, 15804, 2028, 9248, 279, 3685, 2860, 11668, 18979, 315, 220, 966, 4, 320, 605, 4, 304, 279, 1176, 2305, 489, 220, 508, 4, 304, 279, 2132, 2305, 3677, 578, 4320, 374, 400, 13104, 13, 128009]
0: rejected_inputs:
0: <|begin_of_text|><|start_header_id|>user<|end_header_id|>
0: 
0: The price of an iPhone fell 10% in a particular month and another 20% in the second month.  If the initial price was $1000, calculate the price after the second month.<|eot_id|><|start_header_id|>assistant<|end_header_id|>
0: 
0: I'd be happy to help you with that. Here's the solution:
0: 
0: Initially, the price of the iPhone is $1000.
0: 
0: In the first month, the price falls by 10%, which means the new price is:
0: $1000 - (10% of $1000) = $1000 - $100 = $900
0: 
0: In the second month, the price falls by another 20%, which means the new price is:
0: $900 - (20% of $900) = $900 - $180 = $720
0: 
0: Let's verify our calculation by finding the total percentage decrease:
0: Initial price = $1000
0: Price after first month = $900
0: Price after second month = $720
0: 
0: The total percentage decrease = (Initial price - Price after second month) / Initial price
0: = ($1000 - $720) / $1000
0: = $280 / $1000
0: = 28%
0: 
0: This matches the expected total percentage decrease of 30% (10% in the first month + 20% in the second month).
0: 
0:  The answer is $720.<|eot_id|>
0: rejected_label_ids:
0: [-100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, -100, 40, 4265, 387, 6380, 311, 1520, 499, 449, 430, 13, 5810, 596, 279, 6425, 1473, 91084, 11, 279, 3430, 315, 279, 12443, 374, 400, 1041, 15, 382, 644, 279, 1176, 2305, 11, 279, 3430, 17503, 555, 220, 605, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 1041, 15, 482, 320, 605, 4, 315, 400, 1041, 15, 8, 284, 400, 1041, 15, 482, 400, 1041, 284, 400, 7467, 271, 644, 279, 2132, 2305, 11, 279, 3430, 17503, 555, 2500, 220, 508, 13689, 902, 3445, 279, 502, 3430, 374, 512, 3, 7467, 482, 320, 508, 4, 315, 400, 7467, 8, 284, 400, 7467, 482, 400, 5245, 284, 400, 13104, 271, 10267, 596, 10356, 1057, 22702, 555, 9455, 279, 2860, 11668, 18979, 512, 6475, 3430, 284, 400, 1041, 15, 198, 7117, 1306, 1176, 2305, 284, 400, 7467, 1
0: 98, 7117, 1306, 2132, 2305, 284, 400, 13104, 271, 791, 2860, 11668, 18979, 284, 320, 6475, 3430, 482, 8650, 1306, 2132, 2305, 8, 611, 4220, 3430, 198, 28, 1746, 1041, 15, 482, 400, 13104, 8, 611, 400, 1041, 15, 198, 28, 400, 11209, 611, 400, 1041, 15, 198, 28, 220, 1591, 15804, 2028, 9248, 279, 3685, 2860, 11668, 18979, 315, 220, 966, 4, 320, 605, 4, 304, 279, 1176, 2305, 489, 220, 508, 4, 304, 279, 2132, 2305, 3677, 578, 4320, 374, 400, 13104, 13, 128009]
0: rejected_labels:
0: I'd be happy to help you with that. Here's the solution:
0: 
0: Initially, the price of the iPhone is $1000.
0: 
0: In the first month, the price falls by 10%, which means the new price is:
0: $1000 - (10% of $1000) = $1000 - $100 = $900
0: 
0: In the second month, the price falls by another 20%, which means the new price is:
0: $900 - (20% of $900) = $900 - $180 = $720
0: 
0: Let's verify our calculation by finding the total percentage decrease:
0: Initial price = $1000
0: Price after first month = $900
0: Price after second month = $720
0: 
0: The total percentage decrease = (Initial price - Price after second month) / Initial price
0: = ($1000 - $720) / $1000
0: = $280 / $1000
0: = 28%
0: 
0: This matches the expected total percentage decrease of 30% (10% in the first month + 20% in the second month).
0: 
0:  The answer is $720.<|eot_id|>
0: [INFO|configuration_utils.py:679] 2025-01-01 21:29:13,110 >> loading configuration file config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/config.json
0: [INFO|configuration_utils.py:746] 2025-01-01 21:29:13,110 >> Model config LlamaConfig {
0:   "_name_or_path": "meta-llama/Meta-Llama-3-8B-Instruct",
0:   "architectures": [
0:     "LlamaForCausalLM"
0:   ],
0:   "attention_bias": false,
0:   "attention_dropout": 0.0,
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009,
0:   "head_dim": 128,
0:   "hidden_act": "silu",
0:   "hidden_size": 4096,
0:   "initializer_range": 0.02,
0:   "intermediate_size": 14336,
0:   "max_position_embeddings": 8192,
0:   "mlp_bias": false,
0:   "model_type": "llama",
0:   "num_attention_heads": 32,
0:   "num_hidden_layers": 32,
0:   "num_key_value_heads": 8,
0:   "pretraining_tp": 1,
0:   "rms_norm_eps": 1e-05,
0:   "rope_scaling": null,
0:   "rope_theta": 500000.0,
0:   "tie_word_embeddings": false,
0:   "torch_dtype": "bfloat16",
0:   "transformers_version": "4.46.1",
0:   "use_cache": true,
0:   "vocab_size": 128256
0: }
0: 
0: [INFO|modeling_utils.py:3937] 2025-01-01 21:29:13,465 >> loading weights file model.safetensors from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/model.safetensors.index.json
0: [INFO|modeling_utils.py:4080] 2025-01-01 21:29:13,474 >> Detected DeepSpeed ZeRO-3: activating zero.init() for this model
0: [2025-01-01 21:29:13,474] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:13,474] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:13,475] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:13,475] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [WARNING|logging.py:168] 2025-01-01 21:29:13,476 >> You are attempting to use Flash Attention 2.0 without specifying a torch dtype. This might lead to unexpected behaviour
0: [WARNING|logging.py:168] 2025-01-01 21:29:13,476 >> You are attempting to use Flash Attention 2.0 with a model not initialized on GPU. Make sure to move the model to GPU after initializing it on CPU with `model.to('cuda')`.
0: [INFO|configuration_utils.py:1096] 2025-01-01 21:29:13,480 >> Generate config GenerationConfig {
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009
0: }
0: 
0: [2025-01-01 21:29:13,863] [INFO] [partition_parameters.py:348:__exit__] finished initializing model - num_params = 291, num_elems = 8.03B
0: Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:00<00:00,  4.47it/s]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:00<00:00,  3.43it/s]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:00<00:01,  2.79it/s]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:01<00:01,  1.21it/s]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:01<00:01,  1.23it/s]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:01<00:01,  1.28it/s]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:03<00:10,  3.53s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:04<00:01,  1.97s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:04<00:01,  1.96s/it]Loading checkpoint s
0: hards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:04<00:01,  1.95s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:05<00:00,  1.34s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:05<00:00,  1.30s/it]
0: Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:05<00:00,  1.33s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:05<00:00,  1.29s/it]
0: Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:05<00:00,  1.32s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:05<00:00,  1.28s/it]
0: [2025-01-01 21:29:20,296] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:20,307] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:20,499] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:07<00:07,  3.69s/it]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:10<00:03,  3.65s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:11<00:00,  2.46s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:11<00:00,  2.90s/it]
0: [INFO|modeling_utils.py:4800] 2025-01-01 21:29:25,470 >> All model checkpoint weights were used when initializing LlamaForCausalLM.
0: 
0: [INFO|modeling_utils.py:4808] 2025-01-01 21:29:25,470 >> All the weights of LlamaForCausalLM were initialized from the model checkpoint at meta-llama/Meta-Llama-3-8B-Instruct.
0: If your task is similar to the task the model of the checkpoint was trained on, you can already use LlamaForCausalLM for predictions without further training.
0: [INFO|configuration_utils.py:1051] 2025-01-01 21:29:25,520 >> loading configuration file generation_config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/generation_config.json
0: [INFO|configuration_utils.py:1096] 2025-01-01 21:29:25,520 >> Generate config GenerationConfig {
0:   "bos_token_id": 128000,
0:   "do_sample": true,
0:   "eos_token_id": [
0:     128001,
0:     128009
0:   ],
0:   "max_length": 4096,
0:   "temperature": 0.6,
0:   "top_p": 0.9
0: }
0: 
0: [INFO|2025-01-01 21:29:25] llamafactory.model.model_utils.checkpointing:157 >> Gradient checkpointing enabled.
0: [INFO|2025-01-01 21:29:25] llamafactory.model.model_utils.attention:157 >> Using FlashAttention-2 for faster training and inference.
0: [INFO|2025-01-01 21:29:25] llamafactory.model.adapter:157 >> ZeRO3 / FSDP detected, remaining trainable params in float32.
0: [INFO|2025-01-01 21:29:25] llamafactory.model.adapter:157 >> Fine-tuning method: Full
0: [INFO|2025-01-01 21:29:25] llamafactory.model.loader:157 >> trainable params: 8,030,261,248 || all params: 8,030,261,248 || trainable%: 100.0000
0: [INFO|configuration_utils.py:679] 2025-01-01 21:29:25,572 >> loading configuration file config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/config.json
0: [INFO|configuration_utils.py:746] 2025-01-01 21:29:25,573 >> Model config LlamaConfig {
0:   "_name_or_path": "meta-llama/Meta-Llama-3-8B-Instruct",
0:   "architectures": [
0:     "LlamaForCausalLM"
0:   ],
0:   "attention_bias": false,
0:   "attention_dropout": 0.0,
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009,
0:   "head_dim": 128,
0:   "hidden_act": "silu",
0:   "hidden_size": 4096,
0:   "initializer_range": 0.02,
0:   "intermediate_size": 14336,
0:   "max_position_embeddings": 8192,
0:   "mlp_bias": false,
0:   "model_type": "llama",
0:   "num_attention_heads": 32,
0:   "num_hidden_layers": 32,
0:   "num_key_value_heads": 8,
0:   "pretraining_tp": 1,
0:   "rms_norm_eps": 1e-05,
0:   "rope_scaling": null,
0:   "rope_theta": 500000.0,
0:   "tie_word_embeddings": false,
0:   "torch_dtype": "bfloat16",
0:   "transformers_version": "4.46.1",
0:   "use_cache": true,
0:   "vocab_size": 128256
0: }
0: 
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:25,631 >> loading file tokenizer.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:25,631 >> loading file tokenizer.model from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:25,631 >> loading file added_tokens.json from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:25,631 >> loading file special_tokens_map.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/special_tokens_map.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:25,631 >> loading file tokenizer_config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer_config.json
0: [INFO|tokenization_utils_base.py:2475] 2025-01-01 21:29:25,860 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
0: [INFO|configuration_utils.py:679] 2025-01-01 21:29:26,056 >> loading configuration file config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/config.json
0: [INFO|configuration_utils.py:746] 2025-01-01 21:29:26,057 >> Model config LlamaConfig {
0:   "_name_or_path": "meta-llama/Meta-Llama-3-8B-Instruct",
0:   "architectures": [
0:     "LlamaForCausalLM"
0:   ],
0:   "attention_bias": false,
0:   "attention_dropout": 0.0,
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009,
0:   "head_dim": 128,
0:   "hidden_act": "silu",
0:   "hidden_size": 4096,
0:   "initializer_range": 0.02,
0:   "intermediate_size": 14336,
0:   "max_position_embeddings": 8192,
0:   "mlp_bias": false,
0:   "model_type": "llama",
0:   "num_attention_heads": 32,
0:   "num_hidden_layers": 32,
0:   "num_key_value_heads": 8,
0:   "pretraining_tp": 1,
0:   "rms_norm_eps": 1e-05,
0:   "rope_scaling": null,
0:   "rope_theta": 500000.0,
0:   "tie_word_embeddings": false,
0:   "torch_dtype": "bfloat16",
0:   "transformers_version": "4.46.1",
0:   "use_cache": true,
0:   "vocab_size": 128256
0: }
0: 
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:26,107 >> loading file tokenizer.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:26,107 >> loading file tokenizer.model from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:26,107 >> loading file added_tokens.json from cache at None
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:26,107 >> loading file special_tokens_map.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/special_tokens_map.json
0: [INFO|tokenization_utils_base.py:2211] 2025-01-01 21:29:26,107 >> loading file tokenizer_config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/tokenizer_config.json
0: [INFO|tokenization_utils_base.py:2475] 2025-01-01 21:29:26,332 >> Special tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.
0: [INFO|configuration_utils.py:679] 2025-01-01 21:29:26,403 >> loading configuration file config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/config.json
0: [INFO|configuration_utils.py:746] 2025-01-01 21:29:26,403 >> Model config LlamaConfig {
0:   "_name_or_path": "meta-llama/Meta-Llama-3-8B-Instruct",
0:   "architectures": [
0:     "LlamaForCausalLM"
0:   ],
0:   "attention_bias": false,
0:   "attention_dropout": 0.0,
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009,
0:   "head_dim": 128,
0:   "hidden_act": "silu",
0:   "hidden_size": 4096,
0:   "initializer_range": 0.02,
0:   "intermediate_size": 14336,
0:   "max_position_embeddings": 8192,
0:   "mlp_bias": false,
0:   "model_type": "llama",
0:   "num_attention_heads": 32,
0:   "num_hidden_layers": 32,
0:   "num_key_value_heads": 8,
0:   "pretraining_tp": 1,
0:   "rms_norm_eps": 1e-05,
0:   "rope_scaling": null,
0:   "rope_theta": 500000.0,
0:   "tie_word_embeddings": false,
0:   "torch_dtype": "bfloat16",
0:   "transformers_version": "4.46.1",
0:   "use_cache": true,
0:   "vocab_size": 128256
0: }
0: 
0: [INFO|2025-01-01 21:29:26] llamafactory.model.patcher:157 >> Using KV cache for faster generation.
0: [INFO|modeling_utils.py:3937] 2025-01-01 21:29:26,406 >> loading weights file model.safetensors from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/model.safetensors.index.json
0: [INFO|modeling_utils.py:4080] 2025-01-01 21:29:26,409 >> Detected DeepSpeed ZeRO-3: activating zero.init() for this model
0: [2025-01-01 21:29:26,409] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [INFO|configuration_utils.py:1096] 2025-01-01 21:29:26,414 >> Generate config GenerationConfig {
0:   "bos_token_id": 128000,
0:   "eos_token_id": 128009
0: }
0: 
0: [2025-01-01 21:29:26,561] [INFO] [partition_parameters.py:348:__exit__] finished initializing model - num_params = 582, num_elems = 16.06B
0: Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:02<00:07,  2.38s/it]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:02<00:07,  2.41s/it]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:02<00:07,  2.55s/it]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:02<00:02,  1.25s/it]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:02<00:02,  1.25s/it]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:02<00:02,  1.29s/it]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:01<00:03,  1.17s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:04<00:01,  1.21s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:04<00:01,  1.21s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:04<00:01,  1.24s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:04<00:00,  1.25it/s]Loading checkpoint shards: 100%|â
0: –ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:04<00:00,  1.04s/it]
0: Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:04<00:00,  1.24it/s]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:04<00:00,  1.05s/it]
0: [2025-01-01 21:29:28,561] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:28,561] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:04<00:00,  1.15it/s]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:04<00:00,  1.11s/it]
0: [2025-01-01 21:29:28,819] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:02<00:02,  1.18s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:03<00:01,  1.18s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:03<00:00,  1.16it/s]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:03<00:00,  1.03it/s]
0: [INFO|modeling_utils.py:4800] 2025-01-01 21:29:30,485 >> All model checkpoint weights were used when initializing LlamaForCausalLM.
0: 
0: [INFO|modeling_utils.py:4808] 2025-01-01 21:29:30,485 >> All the weights of LlamaForCausalLM were initialized from the model checkpoint at meta-llama/Meta-Llama-3-8B-Instruct.
0: If your task is similar to the task the model of the checkpoint was trained on, you can already use LlamaForCausalLM for predictions without further training.
0: [INFO|configuration_utils.py:1051] 2025-01-01 21:29:30,538 >> loading configuration file generation_config.json from cache at /work/nvme/bcrc/cjin1/.cache/huggingface/hub/models--meta-llama--Meta-Llama-3-8B-Instruct/snapshots/5f0b02c75b57c5855da9ae460ce51323ea669d8a/generation_config.json
0: [INFO|configuration_utils.py:1096] 2025-01-01 21:29:30,538 >> Generate config GenerationConfig {
0:   "bos_token_id": 128000,
0:   "do_sample": true,
0:   "eos_token_id": [
0:     128001,
0:     128009
0:   ],
0:   "max_length": 4096,
0:   "temperature": 0.6,
0:   "top_p": 0.9
0: }
0: 
0: [INFO|2025-01-01 21:29:30] llamafactory.model.model_utils.attention:157 >> Using FlashAttention-2 for faster training and inference.
0: [INFO|2025-01-01 21:29:30] llamafactory.model.loader:157 >> all params: 8,030,261,248
0: [INFO|2025-01-01 21:29:30] llamafactory.train.trainer_utils:157 >> Created reference model from the model itself.
0: [INFO|trainer.py:698] 2025-01-01 21:29:30,588 >> Using auto half precision backend
0: [2025-01-01 21:29:30,588] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed info: version=0.15.4, git-hash=unknown, git-branch=unknown
0: [2025-01-01 21:29:30,588] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:30,595] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
0: [2025-01-01 21:29:30,596] [INFO] [logging.py:128:log_dist] [Rank 0] Creating ZeRO Offload
0: [2025-01-01 21:29:30,730] [INFO] [utils.py:781:see_memory_usage] DeepSpeedZeRoOffload initialize [begin]
0: [2025-01-01 21:29:30,731] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 10.17 GB         CA 10.66 GB         Max_CA 11 GB 
0: [2025-01-01 21:29:30,731] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 150.83 GB, percent = 17.6%
0: Parameter Offload: Total persistent parameters: 266240 in 65 params
0: [2025-01-01 21:29:30,878] [INFO] [utils.py:781:see_memory_usage] DeepSpeedZeRoOffload initialize [end]
0: [2025-01-01 21:29:30,879] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 7.48 GB         CA 10.66 GB         Max_CA 11 GB 
0: [2025-01-01 21:29:30,879] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 150.83 GB, percent = 17.6%
0: [2025-01-01 21:29:30,880] [INFO] [config.py:999:print] DeepSpeedEngine configuration:
0: [2025-01-01 21:29:30,880] [INFO] [config.py:1003:print]   activation_checkpointing_config  {
0:     "partition_activations": false, 
0:     "contiguous_memory_optimization": false, 
0:     "cpu_checkpointing": false, 
0:     "number_checkpoints": null, 
0:     "synchronize_checkpoint_boundary": false, 
0:     "profile": false
0: }
0: [2025-01-01 21:29:30,880] [INFO] [config.py:1003:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True, 'use_gds': False}
0: [2025-01-01 21:29:30,880] [INFO] [config.py:1003:print]   amp_enabled .................. False
0: [2025-01-01 21:29:30,880] [INFO] [config.py:1003:print]   amp_params ................... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   autotuning_config ............ {
0:     "enabled": false, 
0:     "start_step": null, 
0:     "end_step": null, 
0:     "metric_path": null, 
0:     "arg_mappings": null, 
0:     "metric": "throughput", 
0:     "model_info": null, 
0:     "results_dir": "autotuning_results", 
0:     "exps_dir": "autotuning_exps", 
0:     "overwrite": true, 
0:     "fast": true, 
0:     "start_profile_step": 3, 
0:     "end_profile_step": 5, 
0:     "tuner_type": "gridsearch", 
0:     "tuner_early_stopping": 5, 
0:     "tuner_num_trials": 50, 
0:     "model_info_path": null, 
0:     "mp_size": 1, 
0:     "max_train_batch_size": null, 
0:     "min_train_batch_size": 1, 
0:     "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
0:     "min_train_micro_batch_size_per_gpu": 1, 
0:     "num_tuning_micro_batch_sizes": 3
0: }
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   bfloat16_enabled ............. True
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   bfloat16_immediate_grad_update  False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   checkpoint_parallel_write_pipeline  False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   checkpoint_tag_validation_enabled  True
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   checkpoint_tag_validation_fail  False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0xfffa08c70880>
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   communication_data_type ...... None
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_pa
0: rameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   curriculum_enabled_legacy .... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   curriculum_params_legacy ..... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   data_efficiency_enabled ...... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   dataloader_drop_last ......... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   disable_allgather ............ False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   dump_state ................... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   dynamic_loss_scale_args ...... None
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_enabled ........... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_gas_boundary_resolution  1
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_layer_name ........ bert.encoder.layer
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_layer_num ......... 0
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_max_iter .......... 100
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_stability ......... 1e-06
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_tol ............... 0.01
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   eigenvalue_verbose ........... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   elasticity_enabled ........... False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   flops_profiler_config ........ {
0:     "enabled": false, 
0:     "recompute_fwd_factor": 0.0, 
0:     "profile_step": 1, 
0:     "module_depth": -1, 
0:     "top_modules": 1, 
0:     "detailed": true, 
0:     "output_file": null
0: }
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   fp16_auto_cast ............... None
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   fp16_enabled ................. False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   fp16_master_weights_and_gradients  False
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   global_rank .................. 0
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   grad_accum_dtype ............. None
0: [2025-01-01 21:29:30,881] [INFO] [config.py:1003:print]   gradient_accumulation_steps .. 4
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   gradient_clipping ............ 1.0
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   gradient_predivide_factor .... 1.0
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   graph_harvesting ............. False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   initial_dynamic_scale ........ 1
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   load_universal_checkpoint .... False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   loss_scale ................... 1.0
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   memory_breakdown ............. False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   mics_hierarchial_params_gather  False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   mics_shard_size .............. -1
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') comet=CometConfig(enabled=False, samples_log_interval=100, project=None, workspace=None, api_key=None, experiment_name=None, experiment_key=None, online=None, mode=None) wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName')
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   nebula_config ................ {
0:     "enabled": false, 
0:     "persistent_storage_path": null, 
0:     "persistent_time_interval": 100, 
0:     "num_of_version_in_retention": 2, 
0:     "enable_nebula_load": true, 
0:     "load_path": null
0: }
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   optimizer_legacy_fusion ...... False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   optimizer_name ............... None
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   optimizer_params ............. None
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0, 'pipe_partitioned': True, 'grad_partitioned': True}
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   pld_enabled .................. False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   pld_params ................... False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   prescale_gradients ........... False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   scheduler_name ............... None
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   scheduler_params ............. None
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   seq_parallel_communication_data_type  torch.float32
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   sparse_attention ............. None
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   sparse_gradients_enabled ..... False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   steps_per_print .............. inf
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   timers_config ................ enabled=True synchronized=True
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   train_batch_size ............. 64
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   train_micro_batch_size_per_gpu  4
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   use_data_before_expert_parallel_  False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   use_node_local_storage ....... False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   wall_clock_breakdown ......... False
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   weight_quantization_config ... None
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   world_size ................... 4
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   zero_allow_untested_optimizer  True
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   zero_config .................. stage=3 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=500000000 use_multi_rank_bucket_allreduce=True allgather_partitions=True allgather_bucket_size=500000000 overlap_comm=True load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1000000000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=50000000 param_persistence_threshold=100000 model_persistence_threshold=9223372036854775807 max_live_parameters=1000000000 max_reuse_distance=1000000000 gather_16bit_weights_on_model_save=True use_all_reduce_for_fetch_params=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_nontrainable_weights=False zero_quantized_gradients=False mics_shard_size=-1 mics_hierarchical_para
0: ms_gather=False memory_efficient_linear=True pipeline_loading_checkpoint=False override_module_apply=True
0: [2025-01-01 21:29:30,882] [INFO] [config.py:1003:print]   zero_enabled ................. True
0: [2025-01-01 21:29:30,883] [INFO] [config.py:1003:print]   zero_force_ds_cpu_optimizer .. True
0: [2025-01-01 21:29:30,883] [INFO] [config.py:1003:print]   zero_optimization_stage ...... 3
0: [2025-01-01 21:29:30,883] [INFO] [config.py:989:print_user_config]   json = {
0:     "train_batch_size": 64, 
0:     "train_micro_batch_size_per_gpu": 4, 
0:     "gradient_accumulation_steps": 4, 
0:     "gradient_clipping": 1.0, 
0:     "zero_allow_untested_optimizer": true, 
0:     "fp16": {
0:         "enabled": false, 
0:         "loss_scale": 0, 
0:         "loss_scale_window": 1000, 
0:         "initial_scale_power": 16, 
0:         "hysteresis": 2, 
0:         "min_loss_scale": 1
0:     }, 
0:     "bf16": {
0:         "enabled": true
0:     }, 
0:     "zero_optimization": {
0:         "stage": 3, 
0:         "overlap_comm": true, 
0:         "contiguous_gradients": true, 
0:         "sub_group_size": 1.000000e+09, 
0:         "reduce_bucket_size": "auto", 
0:         "stage3_prefetch_bucket_size": "auto", 
0:         "stage3_param_persistence_threshold": "auto", 
0:         "stage3_max_live_parameters": 1.000000e+09, 
0:         "stage3_max_reuse_distance": 1.000000e+09, 
0:         "stage3_gather_16bit_weights_on_model_save": true
0:     }, 
0:     "steps_per_print": inf, 
0:     "zero_optimization.reduce_bucket_size": 1.677722e+07, 
0:     "zero_optimization.stage3_param_persistence_threshold": 4.096000e+04, 
0:     "zero_optimization.stage3_prefetch_bucket_size": 1.509949e+07
0: }
0: [2025-01-01 21:29:31,027] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed info: version=0.15.4, git-hash=unknown, git-branch=unknown
0: [2025-01-01 21:29:31,028] [INFO] [config.py:733:__init__] Config mesh_device None world_size = 4
0: [2025-01-01 21:29:31,035] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Flops Profiler Enabled: False
0: [2025-01-01 21:29:31,036] [INFO] [logging.py:128:log_dist] [Rank 0] Using client Optimizer as basic optimizer
0: [2025-01-01 21:29:31,036] [INFO] [logging.py:128:log_dist] [Rank 0] Removing param_group that has no 'params' in the basic Optimizer
0: [2025-01-01 21:29:31,044] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Basic Optimizer = AdamW
0: [2025-01-01 21:29:31,044] [INFO] [utils.py:59:is_zero_supported_optimizer] Checking ZeRO support for optimizer=AdamW type=<class 'torch.optim.adamw.AdamW'>
0: [2025-01-01 21:29:31,044] [INFO] [logging.py:128:log_dist] [Rank 0] Creating fp16 ZeRO stage 3 optimizer, MiCS is enabled False, Hierarchical params gather False
0: [2025-01-01 21:29:31,044] [INFO] [logging.py:128:log_dist] [Rank 0] Creating torch.bfloat16 ZeRO stage 3 optimizer
0: [2025-01-01 21:29:31,177] [INFO] [utils.py:781:see_memory_usage] Stage 3 initialize beginning
0: [2025-01-01 21:29:31,177] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 7.48 GB         CA 8.71 GB         Max_CA 11 GB 
0: [2025-01-01 21:29:31,178] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 148.87 GB, percent = 17.4%
0: [2025-01-01 21:29:31,179] [INFO] [stage3.py:166:__init__] Reduce bucket size 16777216
0: [2025-01-01 21:29:31,179] [INFO] [stage3.py:167:__init__] Prefetch bucket size 15099494
0: [2025-01-01 21:29:31,310] [INFO] [utils.py:781:see_memory_usage] DeepSpeedZeRoOffload initialize [begin]
0: [2025-01-01 21:29:31,311] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 7.48 GB         CA 8.71 GB         Max_CA 9 GB 
0: [2025-01-01 21:29:31,311] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 148.86 GB, percent = 17.4%
0: Parameter Offload: Total persistent parameters: 266240 in 65 params
0: [2025-01-01 21:29:31,461] [INFO] [utils.py:781:see_memory_usage] DeepSpeedZeRoOffload initialize [end]
0: [2025-01-01 21:29:31,462] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 7.48 GB         CA 8.71 GB         Max_CA 9 GB 
0: [2025-01-01 21:29:31,462] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 148.86 GB, percent = 17.4%
0: [2025-01-01 21:29:31,597] [INFO] [utils.py:781:see_memory_usage] Before creating fp16 partitions
0: [2025-01-01 21:29:31,598] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 7.48 GB         CA 8.71 GB         Max_CA 9 GB 
0: [2025-01-01 21:29:31,598] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 148.86 GB, percent = 17.4%
0: [2025-01-01 21:29:44,560] [INFO] [utils.py:781:see_memory_usage] After creating fp16 partitions: 3
0: [2025-01-01 21:29:44,561] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 7.48 GB         CA 9.29 GB         Max_CA 9 GB 
0: [2025-01-01 21:29:44,561] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 161.22 GB, percent = 18.8%
0: [2025-01-01 21:29:44,702] [INFO] [utils.py:781:see_memory_usage] Before creating fp32 partitions
0: [2025-01-01 21:29:44,703] [INFO] [utils.py:782:see_memory_usage] MA 7.48 GB         Max_MA 7.48 GB         CA 9.29 GB         Max_CA 9 GB 
0: [2025-01-01 21:29:44,703] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 179.31 GB, percent = 20.9%
0: [2025-01-01 21:29:44,863] [INFO] [utils.py:781:see_memory_usage] After creating fp32 partitions
0: [2025-01-01 21:29:44,864] [INFO] [utils.py:782:see_memory_usage] MA 14.96 GB         Max_MA 16.83 GB         CA 18.64 GB         Max_CA 19 GB 
0: [2025-01-01 21:29:44,864] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 188.68 GB, percent = 22.0%
0: [2025-01-01 21:29:45,003] [INFO] [utils.py:781:see_memory_usage] Before initializing optimizer states
0: [2025-01-01 21:29:45,004] [INFO] [utils.py:782:see_memory_usage] MA 14.96 GB         Max_MA 14.96 GB         CA 18.64 GB         Max_CA 19 GB 
0: [2025-01-01 21:29:45,004] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 199.9 GB, percent = 23.3%
0: [2025-01-01 21:29:45,151] [INFO] [utils.py:781:see_memory_usage] After initializing optimizer states
0: [2025-01-01 21:29:45,151] [INFO] [utils.py:782:see_memory_usage] MA 14.96 GB         Max_MA 18.7 GB         CA 22.38 GB         Max_CA 22 GB 
0: [2025-01-01 21:29:45,151] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 203.64 GB, percent = 23.8%
0: [2025-01-01 21:29:45,152] [INFO] [stage3.py:521:_setup_for_real_optimizer] optimizer state initialized
0: [2025-01-01 21:29:45,401] [INFO] [utils.py:781:see_memory_usage] After initializing ZeRO optimizer
0: [2025-01-01 21:29:45,402] [INFO] [utils.py:782:see_memory_usage] MA 18.73 GB         Max_MA 20.69 GB         CA 22.38 GB         Max_CA 22 GB 
0: [2025-01-01 21:29:45,402] [INFO] [utils.py:789:see_memory_usage] CPU Virtual Memory:  used = 203.64 GB, percent = 23.8%
0: [2025-01-01 21:29:45,402] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed Final Optimizer = DeepSpeedZeroOptimizer_Stage3
0: [2025-01-01 21:29:45,402] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed using configured LR scheduler = None
0: [2025-01-01 21:29:45,402] [INFO] [logging.py:128:log_dist] [Rank 0] DeepSpeed LR Scheduler = None
0: [2025-01-01 21:29:45,402] [INFO] [logging.py:128:log_dist] [Rank 0] step=0, skipped=0, lr=[0.0, 0.0], mom=[(0.9, 0.999), (0.9, 0.999)]
0: [2025-01-01 21:29:45,403] [INFO] [config.py:999:print] DeepSpeedEngine configuration:
0: [2025-01-01 21:29:45,403] [INFO] [config.py:1003:print]   activation_checkpointing_config  {
0:     "partition_activations": false, 
0:     "contiguous_memory_optimization": false, 
0:     "cpu_checkpointing": false, 
0:     "number_checkpoints": null, 
0:     "synchronize_checkpoint_boundary": false, 
0:     "profile": false
0: }
0: [2025-01-01 21:29:45,403] [INFO] [config.py:1003:print]   aio_config ................... {'block_size': 1048576, 'queue_depth': 8, 'thread_count': 1, 'single_submit': False, 'overlap_events': True, 'use_gds': False}
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   amp_enabled .................. False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   amp_params ................... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   autotuning_config ............ {
0:     "enabled": false, 
0:     "start_step": null, 
0:     "end_step": null, 
0:     "metric_path": null, 
0:     "arg_mappings": null, 
0:     "metric": "throughput", 
0:     "model_info": null, 
0:     "results_dir": "autotuning_results", 
0:     "exps_dir": "autotuning_exps", 
0:     "overwrite": true, 
0:     "fast": true, 
0:     "start_profile_step": 3, 
0:     "end_profile_step": 5, 
0:     "tuner_type": "gridsearch", 
0:     "tuner_early_stopping": 5, 
0:     "tuner_num_trials": 50, 
0:     "model_info_path": null, 
0:     "mp_size": 1, 
0:     "max_train_batch_size": null, 
0:     "min_train_batch_size": 1, 
0:     "max_train_micro_batch_size_per_gpu": 1.024000e+03, 
0:     "min_train_micro_batch_size_per_gpu": 1, 
0:     "num_tuning_micro_batch_sizes": 3
0: }
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   bfloat16_enabled ............. True
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   bfloat16_immediate_grad_update  False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   checkpoint_parallel_write_pipeline  False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   checkpoint_tag_validation_enabled  True
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   checkpoint_tag_validation_fail  False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   comms_config ................. <deepspeed.comm.config.DeepSpeedCommsConfig object at 0xfffa088843d0>
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   communication_data_type ...... None
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   compression_config ........... {'weight_quantization': {'shared_parameters': {'enabled': False, 'quantizer_kernel': False, 'schedule_offset': 0, 'quantize_groups': 1, 'quantize_verbose': False, 'quantization_type': 'symmetric', 'quantize_weight_in_forward': False, 'rounding': 'nearest', 'fp16_mixed_quantize': False, 'quantize_change_ratio': 0.001}, 'different_groups': {}}, 'activation_quantization': {'shared_parameters': {'enabled': False, 'quantization_type': 'symmetric', 'range_calibration': 'dynamic', 'schedule_offset': 1000}, 'different_groups': {}}, 'sparse_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'row_pruning': {'shared_parameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'head_pruning': {'shared_parameters': {'enabled': False, 'method': 'topk', 'schedule_offset': 1000}, 'different_groups': {}}, 'channel_pruning': {'shared_pa
0: rameters': {'enabled': False, 'method': 'l1', 'schedule_offset': 1000}, 'different_groups': {}}, 'layer_reduction': {'enabled': False}}
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   curriculum_enabled_legacy .... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   curriculum_params_legacy ..... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   data_efficiency_config ....... {'enabled': False, 'seed': 1234, 'data_sampling': {'enabled': False, 'num_epochs': 1000, 'num_workers': 0, 'curriculum_learning': {'enabled': False}}, 'data_routing': {'enabled': False, 'random_ltd': {'enabled': False, 'layer_token_lr_schedule': {'enabled': False}}}}
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   data_efficiency_enabled ...... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   dataloader_drop_last ......... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   disable_allgather ............ False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   dump_state ................... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   dynamic_loss_scale_args ...... None
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_enabled ........... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_gas_boundary_resolution  1
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_layer_name ........ bert.encoder.layer
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_layer_num ......... 0
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_max_iter .......... 100
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_stability ......... 1e-06
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_tol ............... 0.01
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   eigenvalue_verbose ........... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   elasticity_enabled ........... False
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   flops_profiler_config ........ {
0:     "enabled": false, 
0:     "recompute_fwd_factor": 0.0, 
0:     "profile_step": 1, 
0:     "module_depth": -1, 
0:     "top_modules": 1, 
0:     "detailed": true, 
0:     "output_file": null
0: }
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   fp16_auto_cast ............... None
0: [2025-01-01 21:29:45,404] [INFO] [config.py:1003:print]   fp16_enabled ................. False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   fp16_master_weights_and_gradients  False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   global_rank .................. 0
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   grad_accum_dtype ............. None
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   gradient_accumulation_steps .. 4
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   gradient_clipping ............ 1.0
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   gradient_predivide_factor .... 1.0
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   graph_harvesting ............. False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   hybrid_engine ................ enabled=False max_out_tokens=512 inference_tp_size=1 release_inference_cache=False pin_parameters=True tp_gather_partition_size=8
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   initial_dynamic_scale ........ 1
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   load_universal_checkpoint .... False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   loss_scale ................... 1.0
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   memory_breakdown ............. False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   mics_hierarchial_params_gather  False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   mics_shard_size .............. -1
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   monitor_config ............... tensorboard=TensorBoardConfig(enabled=False, output_path='', job_name='DeepSpeedJobName') comet=CometConfig(enabled=False, samples_log_interval=100, project=None, workspace=None, api_key=None, experiment_name=None, experiment_key=None, online=None, mode=None) wandb=WandbConfig(enabled=False, group=None, team=None, project='deepspeed') csv_monitor=CSVConfig(enabled=False, output_path='', job_name='DeepSpeedJobName')
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   nebula_config ................ {
0:     "enabled": false, 
0:     "persistent_storage_path": null, 
0:     "persistent_time_interval": 100, 
0:     "num_of_version_in_retention": 2, 
0:     "enable_nebula_load": true, 
0:     "load_path": null
0: }
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   optimizer_legacy_fusion ...... False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   optimizer_name ............... None
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   optimizer_params ............. None
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   pipeline ..................... {'stages': 'auto', 'partition': 'best', 'seed_layers': False, 'activation_checkpoint_interval': 0, 'pipe_partitioned': True, 'grad_partitioned': True}
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   pld_enabled .................. False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   pld_params ................... False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   prescale_gradients ........... False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   scheduler_name ............... None
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   scheduler_params ............. None
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   seq_parallel_communication_data_type  torch.float32
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   sparse_attention ............. None
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   sparse_gradients_enabled ..... False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   steps_per_print .............. inf
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   timers_config ................ enabled=True synchronized=True
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   train_batch_size ............. 64
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   train_micro_batch_size_per_gpu  4
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   use_data_before_expert_parallel_  False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   use_node_local_storage ....... False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   wall_clock_breakdown ......... False
0: [2025-01-01 21:29:45,405] [INFO] [config.py:1003:print]   weight_quantization_config ... None
0: [2025-01-01 21:29:45,406] [INFO] [config.py:1003:print]   world_size ................... 4
0: [2025-01-01 21:29:45,406] [INFO] [config.py:1003:print]   zero_allow_untested_optimizer  True
0: [2025-01-01 21:29:45,406] [INFO] [config.py:1003:print]   zero_config .................. stage=3 contiguous_gradients=True reduce_scatter=True reduce_bucket_size=16777216 use_multi_rank_bucket_allreduce=True allgather_partitions=True allgather_bucket_size=500000000 overlap_comm=True load_from_fp32_weights=True elastic_checkpoint=False offload_param=None offload_optimizer=None sub_group_size=1000000000 cpu_offload_param=None cpu_offload_use_pin_memory=None cpu_offload=None prefetch_bucket_size=15099494 param_persistence_threshold=40960 model_persistence_threshold=9223372036854775807 max_live_parameters=1000000000 max_reuse_distance=1000000000 gather_16bit_weights_on_model_save=True use_all_reduce_for_fetch_params=False stage3_gather_fp16_weights_on_model_save=False ignore_unused_parameters=True legacy_stage1=False round_robin_gradients=False zero_hpz_partition_size=1 zero_quantized_weights=False zero_quantized_nontrainable_weights=False zero_quantized_gradients=False mics_shard_size=-1 mics_hierarchical_params
0: _gather=False memory_efficient_linear=True pipeline_loading_checkpoint=False override_module_apply=True
0: [2025-01-01 21:29:45,406] [INFO] [config.py:1003:print]   zero_enabled ................. True
0: [2025-01-01 21:29:45,406] [INFO] [config.py:1003:print]   zero_force_ds_cpu_optimizer .. True
0: [2025-01-01 21:29:45,406] [INFO] [config.py:1003:print]   zero_optimization_stage ...... 3
0: [2025-01-01 21:29:45,406] [INFO] [config.py:989:print_user_config]   json = {
0:     "train_batch_size": 64, 
0:     "train_micro_batch_size_per_gpu": 4, 
0:     "gradient_accumulation_steps": 4, 
0:     "gradient_clipping": 1.0, 
0:     "zero_allow_untested_optimizer": true, 
0:     "fp16": {
0:         "enabled": false, 
0:         "loss_scale": 0, 
0:         "loss_scale_window": 1000, 
0:         "initial_scale_power": 16, 
0:         "hysteresis": 2, 
0:         "min_loss_scale": 1
0:     }, 
0:     "bf16": {
0:         "enabled": true
0:     }, 
0:     "zero_optimization": {
0:         "stage": 3, 
0:         "overlap_comm": true, 
0:         "contiguous_gradients": true, 
0:         "sub_group_size": 1.000000e+09, 
0:         "reduce_bucket_size": 1.677722e+07, 
0:         "stage3_prefetch_bucket_size": 1.509949e+07, 
0:         "stage3_param_persistence_threshold": 4.096000e+04, 
0:         "stage3_max_live_parameters": 1.000000e+09, 
0:         "stage3_max_reuse_distance": 1.000000e+09, 
0:         "stage3_gather_16bit_weights_on_model_save": true
0:     }, 
0:     "steps_per_print": inf
0: }
0: [INFO|trainer.py:2313] 2025-01-01 21:29:45,406 >> ***** Running training *****
0: [INFO|trainer.py:2314] 2025-01-01 21:29:45,406 >>   Num examples = 7,473
0: [INFO|trainer.py:2315] 2025-01-01 21:29:45,406 >>   Num Epochs = 1
0: [INFO|trainer.py:2316] 2025-01-01 21:29:45,406 >>   Instantaneous batch size per device = 4
0: [INFO|trainer.py:2319] 2025-01-01 21:29:45,406 >>   Total train batch size (w. parallel, distributed & accumulation) = 64
0: [INFO|trainer.py:2320] 2025-01-01 21:29:45,406 >>   Gradient Accumulation steps = 4
0: [INFO|trainer.py:2321] 2025-01-01 21:29:45,406 >>   Total optimization steps = 117
0: [INFO|trainer.py:2322] 2025-01-01 21:29:45,407 >>   Number of trainable parameters = 8,030,261,248
0: [INFO|integration_utils.py:812] 2025-01-01 21:29:45,408 >> Automatic Weights & Biases logging enabled, to disable set os.environ["WANDB_DISABLED"] = "true"
0: wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
0: wandb: Currently logged in as: jincan333. Use `wandb login --relogin` to force relogin
0: wandb: Tracking run with wandb version 0.19.1
0: wandb: Run data is saved locally in /u/cjin1/LLaMA-Factory/wandb/run-20250101_212948-29lng5xs
0: wandb: Run `wandb offline` to turn off syncing.
0: wandb: Syncing run llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048
0: wandb: â­ï¸ View project at https://wandb.ai/jincan333/safe_reason
0: wandb: ðŸš€ View run at https://wandb.ai/jincan333/safe_reason/runs/29lng5xs
0: {'loss': 0.5344, 'grad_norm': 37.36655362509773, 'learning_rate': 8.333333333333333e-07, 'rewards/chosen': 0.1716770976781845, 'rewards/rejected': -0.30902156233787537, 'rewards/accuracies': 0.715624988079071, 'rewards/margins': 0.4806986451148987, 'logps/chosen': -120.9645767211914, 'logps/rejected': -145.291259765625, 'logits/chosen': -1.106377363204956, 'logits/rejected': -0.36655452847480774, 'epoch': 0.09}
0:   0%|          | 0/117 [00:00<?, ?it/s]  1%|          | 1/117 [00:07<14:15,  7.37s/it]  2%|â–         | 2/117 [00:11<10:35,  5.53s/it]  3%|â–Ž         | 3/117 [00:15<09:00,  4.75s/it]  3%|â–Ž         | 4/117 [00:19<08:16,  4.39s/it]  4%|â–         | 5/117 [00:23<07:48,  4.19s/it]  5%|â–Œ         | 6/117 [00:26<07:29,  4.05s/it]  6%|â–Œ         | 7/117 [00:30<07:17,  3.98s/it]  7%|â–‹         | 8/117 [00:34<07:09,  3.94s/it]  8%|â–Š         | 9/117 [00:38<07:00,  3.89s/it]  9%|â–Š         | 10/117 [00:42<06:53,  3.86s/it]                                                  9%|â–Š         | 10/117 [00:42<06:53,  3.86s/it]  9%|â–‰         | 11/117 [00:45<06:48,  3.85s/it] 10%|â–ˆ         | 12/117 [00:49<06:44,  3.85s/it] 11%|â–ˆ         | 13/117 [00:53<06:38,  3.83s/it] 12%|â–ˆâ–        | 14/117 [00:57<06:32,  3.81s/it] 13%|â–ˆâ–Ž        | 15/117 [01:01<06:27,  3.80s/it] 14%|â–ˆâ–Ž        | 16/117 [01:05<06:28,  3.84s/it] 15%|â–ˆâ–        | 17/117 [01:08<06:26,  3.86s/it] 15%|â–ˆâ–Œ       
0: {'loss': 0.0133, 'grad_norm': 0.00020104710915487236, 'learning_rate': 9.857450191464337e-07, 'rewards/chosen': 2.3184237480163574, 'rewards/rejected': -9.090511322021484, 'rewards/accuracies': 1.0, 'rewards/margins': 11.408935546875, 'logps/chosen': -97.18089294433594, 'logps/rejected': -235.27456665039062, 'logits/chosen': -1.1123018264770508, 'logits/rejected': -0.21500037610530853, 'epoch': 0.17}
0: {'loss': 0.0, 'grad_norm': 1.2332840567355352e-07, 'learning_rate': 9.29224396800933e-07, 'rewards/chosen': 2.542757034301758, 'rewards/rejected': -21.165218353271484, 'rewards/accuracies': 1.0, 'rewards/margins': 23.707975387573242, 'logps/chosen': -96.57317352294922, 'logps/rejected': -353.2354431152344, 'logits/chosen': -1.060902714729309, 'logits/rejected': -0.1992325484752655, 'epoch': 0.26}
0:  | 18/117 [01:12<06:20,  3.84s/it] 16%|â–ˆâ–Œ        | 19/117 [01:16<06:15,  3.84s/it] 17%|â–ˆâ–‹        | 20/117 [01:20<06:11,  3.83s/it]                                                 17%|â–ˆâ–‹        | 20/117 [01:20<06:11,  3.83s/it] 18%|â–ˆâ–Š        | 21/117 [01:24<06:07,  3.82s/it] 19%|â–ˆâ–‰        | 22/117 [01:27<06:01,  3.80s/it] 20%|â–ˆâ–‰        | 23/117 [01:31<06:03,  3.86s/it] 21%|â–ˆâ–ˆ        | 24/117 [01:35<05:57,  3.85s/it] 21%|â–ˆâ–ˆâ–       | 25/117 [01:39<05:52,  3.83s/it] 22%|â–ˆâ–ˆâ–       | 26/117 [01:43<05:54,  3.89s/it] 23%|â–ˆâ–ˆâ–Ž       | 27/117 [01:47<05:49,  3.88s/it] 24%|â–ˆâ–ˆâ–       | 28/117 [01:51<05:44,  3.87s/it] 25%|â–ˆâ–ˆâ–       | 29/117 [01:55<05:38,  3.84s/it] 26%|â–ˆâ–ˆâ–Œ       | 30/117 [01:59<05:37,  3.88s/it]                                                 26%|â–ˆâ–ˆâ–Œ       | 30/117 [01:59<05:37,  3.88s/it] 26%|â–ˆâ–ˆâ–‹       | 31/117 [02:02<05:34,  3.89s/it] 27%|â–ˆâ–ˆâ–‹       | 32/117 [02:06<05:27,  3.86s/it] 28%|â–ˆâ–ˆâ–Š       | 
0: [2025-01-01 21:32:11,462] [WARNING] [stage3.py:2114:step] 1 pytorch allocator cache flushes since last step. this happens when there is high memory pressure and is detrimental to performance. if this is happening frequently consider adjusting settings to reduce memory consumption. If you are unable to make the cache flushes go away consider adding get_accelerator().empty_cache() calls in your training loop to ensure that all ranks flush their caches at the same time
0: {'loss': 0.0, 'grad_norm': 5.37581846828352e-06, 'learning_rate': 8.34565303179429e-07, 'rewards/chosen': -1.358775019645691, 'rewards/rejected': -40.27838897705078, 'rewards/accuracies': 1.0, 'rewards/margins': 38.919612884521484, 'logps/chosen': -136.16738891601562, 'logps/rejected': -546.9091796875, 'logits/chosen': -1.1306074857711792, 'logits/rejected': -0.3656351566314697, 'epoch': 0.34}
0: 33/117 [02:10<05:23,  3.85s/it] 29%|â–ˆâ–ˆâ–‰       | 34/117 [02:14<05:18,  3.84s/it] 30%|â–ˆâ–ˆâ–‰       | 35/117 [02:18<05:19,  3.89s/it] 31%|â–ˆâ–ˆâ–ˆ       | 36/117 [02:22<05:17,  3.91s/it] 32%|â–ˆâ–ˆâ–ˆâ–      | 37/117 [02:26<05:12,  3.91s/it] 32%|â–ˆâ–ˆâ–ˆâ–      | 38/117 [02:30<05:08,  3.90s/it] 33%|â–ˆâ–ˆâ–ˆâ–Ž      | 39/117 [02:34<05:03,  3.89s/it] 34%|â–ˆâ–ˆâ–ˆâ–      | 40/117 [02:38<05:02,  3.93s/it]                                                 34%|â–ˆâ–ˆâ–ˆâ–      | 40/117 [02:38<05:02,  3.93s/it] 35%|â–ˆâ–ˆâ–ˆâ–Œ      | 41/117 [02:42<05:01,  3.97s/it] 36%|â–ˆâ–ˆâ–ˆâ–Œ      | 42/117 [02:46<05:03,  4.05s/it] 37%|â–ˆâ–ˆâ–ˆâ–‹      | 43/117 [02:50<05:04,  4.11s/it] 38%|â–ˆâ–ˆâ–ˆâ–Š      | 44/117 [02:54<04:53,  4.02s/it] 38%|â–ˆâ–ˆâ–ˆâ–Š      | 45/117 [02:58<04:54,  4.09s/it] 39%|â–ˆâ–ˆâ–ˆâ–‰      | 46/117 [03:02<04:46,  4.04s/it] 40%|â–ˆâ–ˆâ–ˆâ–ˆ      | 47/117 [03:06<04:48,  4.12s/it] 41%|â–ˆâ–ˆâ–ˆâ–ˆ      | 48/117 [03:10<04:38,  4.03s/it] 42%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 49/117 [0
0: {'loss': 0.0, 'grad_norm': 7.585566284681886e-06, 'learning_rate': 7.101786141547828e-07, 'rewards/chosen': -0.8704022169113159, 'rewards/rejected': -45.50783157348633, 'rewards/accuracies': 1.0, 'rewards/margins': 44.637428283691406, 'logps/chosen': -132.818603515625, 'logps/rejected': -601.459716796875, 'logits/chosen': -1.1475090980529785, 'logits/rejected': -0.3912527561187744, 'epoch': 0.43}
0: {'loss': 0.0, 'grad_norm': 3.027371826283129e-07, 'learning_rate': 5.671166329088277e-07, 'rewards/chosen': -0.5272694230079651, 'rewards/rejected': -44.90272521972656, 'rewards/accuracies': 1.0, 'rewards/margins': 44.37545394897461, 'logps/chosen': -128.8193359375, 'logps/rejected': -596.1409912109375, 'logits/chosen': -1.1584635972976685, 'logits/rejected': -0.42326611280441284, 'epoch': 0.51}
0: 3:15<04:39,  4.11s/it] 43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 50/117 [03:18<04:32,  4.07s/it]                                                 43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 50/117 [03:18<04:32,  4.07s/it] 44%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 51/117 [03:22<04:25,  4.02s/it] 44%|â–ˆâ–ˆâ–ˆâ–ˆâ–     | 52/117 [03:27<04:25,  4.09s/it] 45%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 53/117 [03:31<04:26,  4.16s/it] 46%|â–ˆâ–ˆâ–ˆâ–ˆâ–Œ     | 54/117 [03:35<04:16,  4.07s/it] 47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 55/117 [03:39<04:07,  3.99s/it] 48%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 56/117 [03:42<04:00,  3.95s/it] 49%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 57/117 [03:46<03:55,  3.92s/it] 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–‰     | 58/117 [03:50<03:55,  3.99s/it] 50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 59/117 [03:54<03:49,  3.95s/it] 51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 60/117 [03:59<03:52,  4.08s/it]                                                 51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 60/117 [03:59<03:52,  4.08s/it] 52%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 61/117 [04:03<03:47,  4.06s/it] 53%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž    | 62/117 [04:06<03:38,  3.97s/it] 54%|â–ˆ
0: {'loss': 0.0, 'grad_norm': 1.7263424335611993e-08, 'learning_rate': 4.180910442924311e-07, 'rewards/chosen': -0.02366561070084572, 'rewards/rejected': -44.570377349853516, 'rewards/accuracies': 1.0, 'rewards/margins': 44.546714782714844, 'logps/chosen': -122.72013092041016, 'logps/rejected': -589.1685791015625, 'logits/chosen': -1.104529619216919, 'logits/rejected': -0.351534366607666, 'epoch': 0.6}
0: â–ˆâ–ˆâ–ˆâ–ˆâ–    | 63/117 [04:10<03:31,  3.91s/it] 55%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 64/117 [04:14<03:27,  3.91s/it] 56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 65/117 [04:19<03:32,  4.09s/it] 56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 66/117 [04:23<03:35,  4.22s/it] 57%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹    | 67/117 [04:28<03:40,  4.41s/it] 58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 68/117 [04:33<03:39,  4.48s/it] 59%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 69/117 [04:37<03:36,  4.51s/it] 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 70/117 [04:42<03:34,  4.57s/it]                                                 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰    | 70/117 [04:42<03:34,  4.57s/it] 61%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 71/117 [04:47<03:32,  4.62s/it] 62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 72/117 [04:51<03:26,  4.59s/it] 62%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 73/117 [04:56<03:23,  4.62s/it] 63%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž   | 74/117 [05:00<03:17,  4.59s/it] 64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 75/117 [05:05<03:12,  4.59s/it] 65%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 76/117 [05:10<03:07,  4.57s/it] 66%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ   | 77/117 [05:14<03:03,  4.59
0: {'loss': 0.0, 'grad_norm': 5.231088609068943e-10, 'learning_rate': 2.763434258421836e-07, 'rewards/chosen': 0.4910540282726288, 'rewards/rejected': -44.31254577636719, 'rewards/accuracies': 1.0, 'rewards/margins': 44.80360412597656, 'logps/chosen': -118.1959228515625, 'logps/rejected': -587.509521484375, 'logits/chosen': -1.1059988737106323, 'logits/rejected': -0.3432506322860718, 'epoch': 0.68}
0: {'loss': 0.0, 'grad_norm': 4.0139697744554255e-11, 'learning_rate': 1.5446867550656767e-07, 'rewards/chosen': 1.2557162046432495, 'rewards/rejected': -43.05473327636719, 'rewards/accuracies': 1.0, 'rewards/margins': 44.310447692871094, 'logps/chosen': -109.2040786743164, 'logps/rejected': -574.448486328125, 'logits/chosen': -1.0679906606674194, 'logits/rejected': -0.30647575855255127, 'epoch': 0.77}
0: s/it] 67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 78/117 [05:19<03:00,  4.62s/it] 68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 79/117 [05:24<02:56,  4.65s/it] 68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 80/117 [05:29<02:54,  4.72s/it]                                                 68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 80/117 [05:29<02:54,  4.72s/it] 69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰   | 81/117 [05:33<02:49,  4.70s/it] 70%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 82/117 [05:38<02:43,  4.68s/it] 71%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ   | 83/117 [05:42<02:39,  4.68s/it] 72%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 84/117 [05:47<02:33,  4.65s/it] 73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 85/117 [05:52<02:28,  4.63s/it] 74%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž  | 86/117 [05:56<02:24,  4.66s/it] 74%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–  | 87/117 [06:01<02:18,  4.62s/it] 75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 88/117 [06:05<02:13,  4.61s/it] 76%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 89/117 [06:10<02:09,  4.64s/it] 77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 90/117 [06:15<02:04,  4.62s/it]                                                 77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–
0: {'loss': 0.0, 'grad_norm': 1.017653405594464e-08, 'learning_rate': 6.329589969143517e-08, 'rewards/chosen': 1.5465734004974365, 'rewards/rejected': -42.73800277709961, 'rewards/accuracies': 1.0, 'rewards/margins': 44.284576416015625, 'logps/chosen': -107.27669525146484, 'logps/rejected': -569.801025390625, 'logits/chosen': -1.0616332292556763, 'logits/rejected': -0.2941460907459259, 'epoch': 0.85}
0: ˆâ–ˆâ–‹  | 90/117 [06:15<02:04,  4.62s/it] 78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 91/117 [06:19<01:59,  4.61s/it] 79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 92/117 [06:24<01:53,  4.53s/it] 79%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰  | 93/117 [06:28<01:47,  4.46s/it] 80%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 94/117 [06:32<01:42,  4.47s/it] 81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  | 95/117 [06:37<01:37,  4.44s/it] 82%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 96/117 [06:41<01:33,  4.46s/it] 83%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž | 97/117 [06:46<01:29,  4.46s/it] 84%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 98/117 [06:50<01:25,  4.50s/it] 85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 99/117 [06:55<01:20,  4.49s/it] 85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 100/117 [06:59<01:15,  4.47s/it]                                                  85%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 100/117 [06:59<01:15,  4.47s/it] 86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 101/117 [07:04<01:13,  4.59s/it] 87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 102/117 [07:09<01:08,  4.57s/it] 88%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š | 103/117 [07:13<01:03,  4.56s/i
0: {'loss': 0.0001, 'grad_norm': 5.935662714678984e-08, 'learning_rate': 1.0926199633097154e-08, 'rewards/chosen': 1.3421303033828735, 'rewards/rejected': -43.81134033203125, 'rewards/accuracies': 1.0, 'rewards/margins': 45.15346908569336, 'logps/chosen': -111.13977813720703, 'logps/rejected': -581.1302490234375, 'logits/chosen': -1.1000343561172485, 'logits/rejected': -0.34123435616493225, 'epoch': 0.94}
0: [2025-01-01 21:37:58,242] [WARNING] [stage3.py:2114:step] 1 pytorch allocator cache flushes since last step. this happens when there is high memory pressure and is detrimental to performance. if this is happening frequently consider adjusting settings to reduce memory consumption. If you are unable to make the cache flushes go away consider adding get_accelerator().empty_cache() calls in your training loop to ensure that all ranks flush their caches at the same time
0: t] 89%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 104/117 [07:18<00:59,  4.56s/it] 90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 105/117 [07:22<00:55,  4.59s/it] 91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ | 106/117 [07:27<00:50,  4.58s/it] 91%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 107/117 [07:32<00:45,  4.57s/it] 92%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 108/117 [07:36<00:41,  4.56s/it] 93%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Ž| 109/117 [07:41<00:36,  4.53s/it] 94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 110/117 [07:45<00:31,  4.53s/it]                                                  94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 110/117 [07:45<00:31,  4.53s/it] 95%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 111/117 [07:50<00:27,  4.54s/it] 96%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ| 112/117 [07:54<00:22,  4.54s/it] 97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 113/117 [07:59<00:18,  4.62s/it] 97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 114/117 [08:04<00:13,  4.62s/it] 98%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 115/117 [08:09<00:09,  4.75s/it] 99%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰| 116/117 [08:13<00:04,  4.74s/
0: it]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 117/117 [08:18<00:00,  4.70s/it][INFO|trainer.py:3801] 2025-01-01 21:39:01,561 >> Saving model checkpoint to /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117
0: [INFO|configuration_utils.py:414] 2025-01-01 21:39:01,569 >> Configuration saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/config.json
0: [INFO|configuration_utils.py:865] 2025-01-01 21:39:01,571 >> Configuration saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/generation_config.json
0: [INFO|modeling_utils.py:3043] 2025-01-01 21:39:09,541 >> The model is bigger than the maximum size per checkpoint (5GB) and is going to be split in 4 checkpoint shards. You can find where each parameters has been saved in the index located at /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/model.safetensors.index.json.
0: [INFO|tokenization_utils_base.py:2646] 2025-01-01 21:39:09,545 >> tokenizer config file saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/tokenizer_config.json
0: [INFO|tokenization_utils_base.py:2655] 2025-01-01 21:39:09,546 >> Special tokens file saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/special_tokens_map.json
0: [2025-01-01 21:39:09,858] [INFO] [logging.py:128:log_dist] [Rank 0] [Torch] Checkpoint global_step117 is about to be saved!
0: [2025-01-01 21:39:13,539] [INFO] [logging.py:128:log_dist] [Rank 0] Saving model checkpoint: /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/global_step117/zero_pp_rank_0_mp_rank_00_model_states.pt
0: [2025-01-01 21:39:13,539] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/global_step117/zero_pp_rank_0_mp_rank_00_model_states.pt...
0: [2025-01-01 21:39:13,552] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/global_step117/zero_pp_rank_0_mp_rank_00_model_states.pt.
0: [2025-01-01 21:39:13,554] [INFO] [torch_checkpoint_engine.py:21:save] [Torch] Saving /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/global_step117/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt...
0: [2025-01-01 21:40:43,579] [INFO] [torch_checkpoint_engine.py:23:save] [Torch] Saved /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/global_step117/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt.
0: [2025-01-01 21:40:43,589] [INFO] [engine.py:3536:_save_zero_checkpoint] zero checkpoint saved /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/checkpoint-117/global_step117/bf16_zero_pp_rank_0_mp_rank_00_optim_states.pt
0: [2025-01-01 21:41:49,302] [INFO] [torch_checkpoint_engine.py:33:commit] [Torch] Checkpoint global_step117 is ready now!
0: [INFO|trainer.py:2584] 2025-01-01 21:41:49,313 >> 
0: 
0: Training completed. Do not forget to share your model on huggingface.co/models =)
0: 
0: 
0: {'train_runtime': 723.9079, 'train_samples_per_second': 10.323, 'train_steps_per_second': 0.162, 'train_loss': 0.04682826520755294, 'epoch': 1.0}
0:                                                  100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 117/117 [12:00<00:00,  4.70s/it]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 117/117 [12:00<00:00,  6.16s/it]
0: [INFO|trainer.py:3801] 2025-01-01 21:42:42,344 >> Saving model checkpoint to /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048
0: [INFO|configuration_utils.py:414] 2025-01-01 21:42:42,351 >> Configuration saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/config.json
0: [INFO|configuration_utils.py:865] 2025-01-01 21:42:42,354 >> Configuration saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/generation_config.json
0: [INFO|modeling_utils.py:3043] 2025-01-01 21:42:48,490 >> The model is bigger than the maximum size per checkpoint (5GB) and is going to be split in 4 checkpoint shards. You can find where each parameters has been saved in the index located at /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/model.safetensors.index.json.
0: [INFO|tokenization_utils_base.py:2646] 2025-01-01 21:42:48,497 >> tokenizer config file saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/tokenizer_config.json
0: [INFO|tokenization_utils_base.py:2655] 2025-01-01 21:42:48,498 >> Special tokens file saved in /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/special_tokens_map.json
0: ***** train metrics *****
0:   epoch                    =        1.0
0:   total_flos               =     8554GF
0:   train_loss               =     0.0468
0:   train_runtime            = 0:12:03.90
0:   train_samples_per_second =     10.323
0:   train_steps_per_second   =      0.162
0: Figure saved at: /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/training_loss.png
0: [WARNING|2025-01-01 21:42:48] llamafactory.extras.ploting:162 >> No metric eval_loss to plot.
0: Figure saved at: /work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048/training_rewards_accuracies.png
0: [INFO|trainer.py:4117] 2025-01-01 21:42:49,013 >> 
0: ***** Running Evaluation *****
0: [INFO|trainer.py:4119] 2025-01-01 21:42:49,014 >>   Num examples = 7473
0: [INFO|trainer.py:4122] 2025-01-01 21:42:49,014 >>   Batch size = 16
0:   0%|          | 0/117 [00:00<?, ?it/s]  2%|â–         | 2/117 [00:01<01:30,  1.27it/s][rank3]: Traceback (most recent call last):
0: [rank3]:   File "/u/cjin1/LLaMA-Factory/src/llamafactory/launcher.py", line 23, in <module>
0: [rank3]:     launch()
0: [rank3]:   File "/u/cjin1/LLaMA-Factory/src/llamafactory/launcher.py", line 19, in launch
0: [rank3]:     run_exp()
0: [rank3]:   File "/u/cjin1/LLaMA-Factory/src/llamafactory/train/tuner.py", line 65, in run_exp
0: [rank3]:     run_dpo(model_args, data_args, training_args, finetuning_args, callbacks)
0: [rank3]:   File "/u/cjin1/LLaMA-Factory/src/llamafactory/train/dpo/workflow.py", line 98, in run_dpo
0: [rank3]:     metrics = trainer.evaluate(metric_key_prefix="eval")
0: [rank3]:   File "/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/transformers/trainer.py", line 3964, in evaluate
0: [rank3]:     output = eval_loop(
0: [rank3]:   File "/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/trl/trainer/dpo_trainer.py", line 1553, in evaluation_loop
0: [rank3]:     initial_output = super().evaluation_loop(
0: [rank3]:   File "/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/transformers/trainer.py", line 4158, in evaluation_loop
0: [rank3]:     losses, logits, labels = self.prediction_step(model, inputs, prediction_loss_only, ignore_keys=ignore_keys)
0: [rank3]:   File "/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/trl/trainer/dpo_trainer.py", line 1486, in prediction_step
0: [rank3]:     loss, metrics = self.get_batch_loss_metrics(model, inputs, train_eval="eval")
0: [rank3]:   File "/u/cjin1/LLaMA-Factory/src/llamafactory/train/dpo/trainer.py", line 248, in get_batch_loss_metrics
0: [rank3]:     ) = self.concatenated_forward(model, batch)
0: [rank3]:   File "/u/cjin1/LLaMA-Factory/src/llamafactory/train/dpo/trainer.py", line 198, in concatenated_forward
0: [rank3]:     all_logits: "torch.Tensor" = model(**batch, return_dict=True, use_cache=False).logits.to(torch.float32)
0: [rank3]:   File "/usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py", line 1736, in _wrapped_call_impl
0: [rank3]:     return self._call_impl(*args, **kwargs)
0: [rank3]:   File "/usr/local/lib/python3.10/dist-packages/torch/nn/modules/module.py", line 1788, in _call_impl
0: [rank3]:     result = forward_call(*args, **kwargs)
0: [rank3]:   File "/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/transformers/models/llama/modeling_llama.py", line 1214, in forward
0: [rank3]:     loss = self.loss_function(logits=logits, labels=labels, vocab_size=self.config.vocab_size, **loss_kwargs)
0: [rank3]:   File "/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/transformers/loss/loss_utils.py", line 46, in ForCausalLMLoss
0: [rank3]:     loss = fixed_cross_entropy(shift_logits, shift_labels, num_items_in_batch, ignore_index, **kwargs)
0: [rank3]:   File "/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/transformers/loss/loss_utils.py", line 26, in fixed_cross_entropy
0: [rank3]:     loss = nn.functional.cross_entropy(source, target, ignore_index=ignore_index, reduction=reduction)
0: [rank3]:   File "/usr/local/lib/python3.10/dist-packages/torch/nn/functional.py", line 3479, in cross_entropy
0: [rank3]:     return torch._C._nn.cross_entropy_loss(
0: [rank3]: torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 12.83 GiB. GPU 3 has a total capacity of 94.50 GiB of which 15.44 GiB is free. Including non-PyTorch memory, this process has 78.96 GiB memory in use. Of the allocated memory 70.58 GiB is allocated by PyTorch, and 6.45 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
0: W0101 21:42:56.374000 998903 torch/distributed/elastic/multiprocessing/api.py:891] Sending process 998913 closing signal SIGTERM
0: W0101 21:42:56.376000 998903 torch/distributed/elastic/multiprocessing/api.py:891] Sending process 998914 closing signal SIGTERM
0: W0101 21:42:56.377000 998903 torch/distributed/elastic/multiprocessing/api.py:891] Sending process 998915 closing signal SIGTERM
0: E0101 21:42:56.993000 998903 torch/distributed/elastic/multiprocessing/api.py:863] failed (exitcode: 1) local_rank: 3 (pid: 998916) of binary: /usr/bin/python
0: Traceback (most recent call last):
0:   File "/usr/local/bin/torchrun", line 33, in <module>
0:     sys.exit(load_entry_point('torch==2.5.0a0+b465a5843b.nv24.9', 'console_scripts', 'torchrun')())
0:   File "/usr/local/lib/python3.10/dist-packages/torch/distributed/elastic/multiprocessing/errors/__init__.py", line 355, in wrapper
0:     return f(*args, **kwargs)
0:   File "/usr/local/lib/python3.10/dist-packages/torch/distributed/run.py", line 919, in main
0:     run(args)
0:   File "/usr/local/lib/python3.10/dist-packages/torch/distributed/run.py", line 910, in run
0:     elastic_launch(
0:   File "/usr/local/lib/python3.10/dist-packages/torch/distributed/launcher/api.py", line 138, in __call__
0:     return launch_agent(self._config, self._entrypoint, list(args))
0:   File "/usr/local/lib/python3.10/dist-packages/torch/distributed/launcher/api.py", line 269, in launch_agent
0:     raise ChildFailedError(
0: torch.distributed.elastic.multiprocessing.errors.ChildFailedError: 
0: ============================================================
0: /u/cjin1/LLaMA-Factory/src/llamafactory/launcher.py FAILED
0: ------------------------------------------------------------
0: Failures:
0:   <NO_OTHER_FAILURES>
0: ------------------------------------------------------------
0: Root Cause (first observed failure):
0: [0]:
0:   time      : 2025-01-01_21:42:56
0:   host      : gh119.hsn.cm.delta.internal.ncsa.edu
0:   rank      : 3 (local_rank: 3)
0:   exitcode  : 1 (pid: 998916)
0:   error_file: <N/A>
0:   traceback : To enable traceback see: https://pytorch.org/docs/stable/elastic/errors.html
0: ============================================================
0: The following values were not passed to `accelerate launch` and had defaults used instead:
0: 	`--num_processes` was set to a value of `1`
0: 	`--num_machines` was set to a value of `1`
0: 	`--mixed_precision` was set to a value of `'no'`
0: 	`--dynamo_backend` was set to a value of `'no'`
0: To avoid this warning pass in values for each of the problematic parameters or run `accelerate config`.
0: wandb: Using wandb-core as the SDK backend.  Please refer to https://wandb.me/wandb-core for more information.
0: wandb: Currently logged in as: jincan333. Use `wandb login --relogin` to force relogin
0: wandb: Tracking run with wandb version 0.19.1
0: wandb: Run data is saved locally in /u/cjin1/LLaMA-Factory/wandb/run-20250101_214306-emwvokmy
0: wandb: Run `wandb offline` to turn off syncing.
0: wandb: Syncing run llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048_eval
0: wandb: â­ï¸ View project at https://wandb.ai/jincan333/safe_reason
0: wandb: ðŸš€ View run at https://wandb.ai/jincan333/safe_reason/runs/emwvokmy
0: 2025-01-01:21:43:07,111 INFO     [__main__.py:279] Verbosity set to INFO
0: 2025-01-01:21:43:17,318 INFO     [__main__.py:376] Selected Tasks: ['gsm8k']
0: 2025-01-01:21:43:17,326 INFO     [evaluator.py:164] Setting random seed to 0 | Setting numpy seed to 1234 | Setting torch manual seed to 1234 | Setting fewshot manual seed to 1234
0: 2025-01-01:21:43:17,326 WARNING  [evaluator.py:175] generation_kwargs specified through cli, these settings will update set parameters in yaml tasks. Ensure 'do_sample=True' for non-greedy decoding!
0: 2025-01-01:21:43:17,326 INFO     [evaluator.py:201] Initializing hf model, with arguments: {'pretrained': '/work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048', 'dtype': 'auto'}
0: 2025-01-01:21:43:18,937 INFO     [huggingface.py:132] Using device 'cuda'
0: 2025-01-01:21:43:19,282 INFO     [huggingface.py:369] Model parallel was set to False, max memory was not set, and device map was set to {'': 'cuda'}
0: Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|â–ˆâ–ˆâ–Œ       | 1/4 [00:02<00:06,  2.24s/it]Loading checkpoint shards:  50%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ     | 2/4 [00:03<00:03,  1.82s/it]Loading checkpoint shards:  75%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  | 3/4 [00:06<00:02,  2.16s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:06<00:00,  1.54s/it]Loading checkpoint shards: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 4/4 [00:06<00:00,  1.73s/it]
0: 2025-01-01:21:43:32,503 WARNING  [evaluator.py:270] Overwriting default num_fewshot of gsm8k from 5 to 5
0: 2025-01-01:21:43:32,504 WARNING  [evaluator.py:406] Chat template formatting change affects loglikelihood and multiple-choice tasks. See docs/chat-template-readme.md for details.
0: 2025-01-01:21:43:32,505 INFO     [task.py:415] Building contexts for gsm8k on rank 0...
0:   0%|          | 0/1319 [00:00<?, ?it/s]  4%|â–         | 52/1319 [00:00<00:02, 519.19it/s]  8%|â–Š         | 108/1319 [00:00<00:02, 541.88it/s] 13%|â–ˆâ–Ž        | 165/1319 [00:00<00:02, 551.49it/s] 17%|â–ˆâ–‹        | 222/1319 [00:00<00:01, 555.47it/s] 21%|â–ˆâ–ˆ        | 279/1319 [00:00<00:01, 557.63it/s] 25%|â–ˆâ–ˆâ–Œ       | 336/1319 [00:00<00:01, 558.57it/s] 30%|â–ˆâ–ˆâ–‰       | 393/1319 [00:00<00:01, 559.93it/s] 34%|â–ˆâ–ˆâ–ˆâ–      | 450/1319 [00:00<00:01, 560.50it/s] 38%|â–ˆâ–ˆâ–ˆâ–Š      | 507/1319 [00:00<00:01, 561.65it/s] 43%|â–ˆâ–ˆâ–ˆâ–ˆâ–Ž     | 564/1319 [00:01<00:01, 562.83it/s] 47%|â–ˆâ–ˆâ–ˆâ–ˆâ–‹     | 621/1319 [00:01<00:01, 562.21it/s] 51%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–    | 678/1319 [00:01<00:01, 561.92it/s] 56%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ    | 735/1319 [00:01<00:01, 556.94it/s] 60%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ    | 792/1319 [00:01<00:00, 558.11it/s] 64%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–   | 848/1319 [00:01<00:00, 557.66it/s] 69%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 904/1319 [00:01<00:00, 557.23it/s] 73%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
0: â–ˆâ–Ž  | 960/1319 [00:01<00:00, 557.88it/s] 77%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹  | 1016/1319 [00:01<00:00, 558.49it/s] 81%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ– | 1073/1319 [00:01<00:00, 560.01it/s] 86%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ | 1130/1319 [00:02<00:00, 560.57it/s] 90%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‰ | 1187/1319 [00:02<00:00, 560.43it/s] 94%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–| 1244/1319 [00:02<00:00, 560.45it/s] 99%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š| 1301/1319 [00:02<00:00, 559.77it/s]100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1319/1319 [00:02<00:00, 558.18it/s]
0: 2025-01-01:21:43:34,883 INFO     [evaluator_utils.py:196] Task: ConfigurableTask(task_name=gsm8k,output_type=generate_until,num_fewshot=5,num_samples=1319); document 0; context prompt (starting on next line):    
0: <|begin_of_text|><|start_header_id|>user<|end_header_id|>
0: 
0: Question: Steve finds 100 gold bars while visiting Oregon. He wants to distribute his gold bars evenly to his 4 friends. If 20 gold bars were lost on the way back to San Diego, how many gold bars will each of his 4 friends get when he returns?
0: Answer: He only has 100 - 20 = <<100-20=80>>80 gold bars after losing 20 of them.
0: He then gives each of his friends 80 Ã· 4 = <<80/4=20>>20 gold bars.
0: #### 20
0: 
0: Question: In a week, Mortdecai collects 8 dozen  eggs every Tuesday and Thursday, and he delivers 3 dozen  eggs to the market and 5 dozen eggs to the mall. He then uses 4 dozen eggs to make a pie every Saturday. Mortdecai donates the remaining eggs to the charity by Sunday. How many  eggs does he donate to the charity?
0: Answer: Mortdecai collects a total of 8x2 = <<8*2=16>>16 dozens of eggs.
0: He sells a total of 3 + 5 = <<3+5=8>>8 dozens of eggs.
0: So, 16 - 8 = <<16-8=8>>8 dozens of eggs are left.
0: After using 4 dozens of eggs to make a pie, 8 - 4 = <<8-4=4>>4 dozens of eggs are left.
0: Since there are 12 in 1 dozen, then Mortdecai donates 4 x 12 = <<4*12=48>>48 pieces of eggs to the charity.
0: #### 48
0: 
0: Question: Corey downloaded two movie series from his Netflix account with 12 and 14 seasons per series, respectively. However, in the week, his computer got a mechanical failure, and he lost two episodes from each season for both series. If each season in the movie series that Corey downloaded had 16 episodes, how many episodes remained after the computer's mechanical failure?
0: Answer: In the first movie series with 12 seasons, after the mechanical failure, the number of episodes that Corey lost is 2*12 = <<2*12=24>>24
0: Originally, the movie series with 12 seasons had 12*16 = <<12*16=192>>192 episodes.
0: After the mechanical failure, Corey had 192-24 = <<192-24=168>>168 episodes remaining in the first movie series.
0: Similarly, the 14 season movie series also had 14*2 = <<14*2=28>>28 lost after the computer's mechanical failure.
0: Originally, the movie series with 14 seasons has 14*16 = <<14*16=224>>224 episodes.
0: The mechanical failure of the computer reduced the number of episodes in the 14 season movie series to 224-28 = <<224-28=196>>196
0: After the loss, Corey had 196+168 = <<196+168=364>>364 episodes remaining from the two movie series he had downloaded.
0: #### 364
0: 
0: Question: There were 18 students assigned in a minibus for a field trip. Eight of these students were boys. On the day of the field trip, the number of girls and boys was the same since some of the girls were not able to join the trip. How many girls were not able to join the field trip?
0: Answer: 8 boys + 8 girls = <<8+8=16>>16 students joined the field trip.
0: Thus, 18 - 16 = <<18-16=2>>2 girls were not able to join the field trip.
0: #### 2
0: 
0: Question: There are 200 more red apples than green apples in a grocery store. A truck arrives and delivers another 340 green apples. If there were originally 32 green apples, how many more green apples than red apples are there in the store now?
0: Answer: There are 200 + 32 = <<200+32=232>>232 red apples.
0: After the delivery there are 340 + 32 = <<340+32=372>>372 green apples
0: There are now 372 - 232 = <<372-232=140>>140 more green apples than red apples now.
0: #### 140
0: 
0: Question: Janetâ€™s ducks lay 16 eggs per day. She eats three for breakfast every morning and bakes muffins for her friends every day with four. She sells the remainder at the farmers' market daily for $2 per fresh duck egg. How much in dollars does she make every day at the farmers' market?
0: Answer:<|eot_id|><|start_header_id|>assistant<|end_header_id|>
0: 
0: 
0: (end of prompt on previous line)
0: target string or answer choice index (starting on next line):
0: Janet sells 16 - 3 - 4 = <<16-3-4=9>>9 duck eggs a day.
0: She makes 9 * 2 = $<<9*2=18>>18 every day at the farmerâ€™s market.
0: #### 18
0: (end of target on previous line)
0: 2025-01-01:21:43:34,883 INFO     [evaluator_utils.py:200] Request: Instance(request_type='generate_until', doc={'question': "Janetâ€™s ducks lay 16 eggs per day. She eats three for breakfast every morning and bakes muffins for her friends every day with four. She sells the remainder at the farmers' market daily for $2 per fresh duck egg. How much in dollars does she make every day at the farmers' market?", 'answer': 'Janet sells 16 - 3 - 4 = <<16-3-4=9>>9 duck eggs a day.\nShe makes 9 * 2 = $<<9*2=18>>18 every day at the farmerâ€™s market.\n#### 18'}, arguments=("<|begin_of_text|><|start_header_id|>user<|end_header_id|>\n\nQuestion: Steve finds 100 gold bars while visiting Oregon. He wants to distribute his gold bars evenly to his 4 friends. If 20 gold bars were lost on the way back to San Diego, how many gold bars will each of his 4 friends get when he returns?\nAnswer: He only has 100 - 20 = <<100-20=80>>80 gold bars after losing 20 of them.\nHe then gives each of his friends 80 Ã· 4 = <<80/4=20>>20 gold ba
0: rs.\n#### 20\n\nQuestion: In a week, Mortdecai collects 8 dozen  eggs every Tuesday and Thursday, and he delivers 3 dozen  eggs to the market and 5 dozen eggs to the mall. He then uses 4 dozen eggs to make a pie every Saturday. Mortdecai donates the remaining eggs to the charity by Sunday. How many  eggs does he donate to the charity?\nAnswer: Mortdecai collects a total of 8x2 = <<8*2=16>>16 dozens of eggs.\nHe sells a total of 3 + 5 = <<3+5=8>>8 dozens of eggs.\nSo, 16 - 8 = <<16-8=8>>8 dozens of eggs are left.\nAfter using 4 dozens of eggs to make a pie, 8 - 4 = <<8-4=4>>4 dozens of eggs are left.\nSince there are 12 in 1 dozen, then Mortdecai donates 4 x 12 = <<4*12=48>>48 pieces of eggs to the charity.\n#### 48\n\nQuestion: Corey downloaded two movie series from his Netflix account with 12 and 14 seasons per series, respectively. However, in the week, his computer got a mechanical failure, and he lost two episodes from each season for both series. If each season in the movie series that Corey downloaded h
0: ad 16 episodes, how many episodes remained after the computer's mechanical failure?\nAnswer: In the first movie series with 12 seasons, after the mechanical failure, the number of episodes that Corey lost is 2*12 = <<2*12=24>>24\nOriginally, the movie series with 12 seasons had 12*16 = <<12*16=192>>192 episodes.\nAfter the mechanical failure, Corey had 192-24 = <<192-24=168>>168 episodes remaining in the first movie series.\nSimilarly, the 14 season movie series also had 14*2 = <<14*2=28>>28 lost after the computer's mechanical failure.\nOriginally, the movie series with 14 seasons has 14*16 = <<14*16=224>>224 episodes.\nThe mechanical failure of the computer reduced the number of episodes in the 14 season movie series to 224-28 = <<224-28=196>>196\nAfter the loss, Corey had 196+168 = <<196+168=364>>364 episodes remaining from the two movie series he had downloaded.\n#### 364\n\nQuestion: There were 18 students assigned in a minibus for a field trip. Eight of these students were boys. On the day of the field 
0: trip, the number of girls and boys was the same since some of the girls were not able to join the trip. How many girls were not able to join the field trip?\nAnswer: 8 boys + 8 girls = <<8+8=16>>16 students joined the field trip.\nThus, 18 - 16 = <<18-16=2>>2 girls were not able to join the field trip.\n#### 2\n\nQuestion: There are 200 more red apples than green apples in a grocery store. A truck arrives and delivers another 340 green apples. If there were originally 32 green apples, how many more green apples than red apples are there in the store now?\nAnswer: There are 200 + 32 = <<200+32=232>>232 red apples.\nAfter the delivery there are 340 + 32 = <<340+32=372>>372 green apples\nThere are now 372 - 232 = <<372-232=140>>140 more green apples than red apples now.\n#### 140\n\nQuestion: Janetâ€™s ducks lay 16 eggs per day. She eats three for breakfast every morning and bakes muffins for her friends every day with four. She sells the remainder at the farmers' market daily for $2 per fresh duck egg. How much
0:  in dollars does she make every day at the farmers' market?\nAnswer:<|eot_id|><|start_header_id|>assistant<|end_header_id|>\n\n", {'until': ['Question:', '</s>', '<|im_end|>'], 'do_sample': False, 'temperature': 0, 'top_p': 1}), idx=0, metadata=('gsm8k', 0, 1), resps=[], filtered_resps={}, task_name='gsm8k', doc_id=0, repeats=1)
0: 2025-01-01:21:43:34,883 INFO     [evaluator.py:496] Running generate_until requests
0: Running generate_until requests:   0%|          | 0/1319 [00:00<?, ?it/s]/u/cjin1/.my_envs/llamafactory/lib/python3.10/site-packages/transformers/generation/configuration_utils.py:590: UserWarning: `do_sample` is set to `False`. However, `temperature` is set to `0.6` -- this flag is only used in sample-based generation modes. You should set `do_sample=True` or unset `temperature`.
0:   warnings.warn(
0: Running generate_until requests:   0%|          | 1/1319 [01:06<24:16:09, 66.29s/it]Running generate_until requests:  10%|â–‰         | 129/1319 [01:57<15:03,  1.32it/s] Running generate_until requests:  19%|â–ˆâ–‰        | 257/1319 [02:46<09:31,  1.86it/s]Running generate_until requests:  29%|â–ˆâ–ˆâ–‰       | 385/1319 [03:33<07:10,  2.17it/s]Running generate_until requests:  39%|â–ˆâ–ˆâ–ˆâ–‰      | 513/1319 [04:19<05:39,  2.38it/s]Running generate_until requests:  49%|â–ˆâ–ˆâ–ˆâ–ˆâ–Š     | 641/1319 [05:04<04:27,  2.53it/s]Running generate_until requests:  58%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š    | 769/1319 [05:47<03:26,  2.66it/s]Running generate_until requests:  67%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹   | 889/1319 [05:47<01:51,  3.87it/s]Running generate_until requests:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 896/1319 [06:04<01:49,  3.87it/s]Running generate_until requests:  68%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š   | 897/1319 [06:30<02:51,  2.46it/s]Running generate_until requests:  78%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Š  | 1025/1319 [07:12<01:49,  2.68it
0: /s]Running generate_until requests:  87%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹ | 1153/1319 [07:52<00:58,  2.85it/s]Running generate_until requests:  97%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‹| 1281/1319 [08:05<00:10,  3.74it/s]Running generate_until requests: 100%|â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ| 1319/1319 [08:05<00:00,  2.72it/s]
0: 2025-01-01:21:51:49,926 INFO     [evaluation_tracker.py:206] Saving results aggregated
0: 2025-01-01:21:51:49,938 INFO     [evaluation_tracker.py:287] Saving per-sample results for: gsm8k
0: wandb:                                                                                
0: wandb: 
0: wandb: Run history:
0: wandb:        gsm8k/exact_match,flexible-extract â–
0: wandb:            gsm8k/exact_match,strict-match â–
0: wandb: gsm8k/exact_match_stderr,flexible-extract â–
0: wandb:     gsm8k/exact_match_stderr,strict-match â–
0: wandb: 
0: wandb: Run summary:
0: wandb:                               gsm8k/alias gsm8k
0: wandb:        gsm8k/exact_match,flexible-extract 0.19181
0: wandb:            gsm8k/exact_match,strict-match 0.17513
0: wandb: gsm8k/exact_match_stderr,flexible-extract 0.01085
0: wandb:     gsm8k/exact_match_stderr,strict-match 0.01047
0: wandb: 
0: wandb: ðŸš€ View run llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048_eval at: https://wandb.ai/jincan333/safe_reason/runs/emwvokmy
0: wandb: â­ï¸ View project at: https://wandb.ai/jincan333/safe_reason
0: wandb: Synced 5 W&B file(s), 0 media file(s), 8 artifact file(s) and 2 other file(s)
0: wandb: Find logs at: ./wandb/run-20250101_214306-emwvokmy/logs
0: hf (pretrained=/work/nvme/bcrc/cjin1/safe_reason/llama3_sft_gsm8k_real_dpo_tbs4_ebs16_lr1e-6_cl2048,dtype=auto), gen_kwargs: (top_p=1,temperature=0), limit: None, num_fewshot: 5, batch_size: 128
0: |Tasks|Version|     Filter     |n-shot|  Metric   |   |Value |   |Stderr|
0: |-----|------:|----------------|-----:|-----------|---|-----:|---|-----:|
0: |gsm8k|      3|flexible-extract|     5|exact_match|â†‘  |0.1918|Â±  |0.0108|
0: |     |       |strict-match    |     5|exact_match|â†‘  |0.1751|Â±  |0.0105|
0: 
